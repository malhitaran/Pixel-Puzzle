KMD
00000000:       ; 
00000000:       ; ORG 0x0000
00000000: F079  ; B REET
00000001:       ; 
00000001:       ; ; ==============================================================================
00000001:       ; ; MAIN TABLE (Root Pointers)
00000001:       ; ; ==============================================================================
00000001:       ; MAIN_TABLE:
00000001: 000B  ;     COLOUR_TABLE_POINTER:       DEFW COLOUR_TABLE
00000002: 000F  ;     ADDRESS_TABLE_POINTER:      DEFW ADDRESS_TABLE
00000003: 0017  ;     SOUND_TABLE_POINTER:        DEFW SOUND_TABLE
00000004: 001E  ;     KEYPAD_TABLE_POINTER:       DEFW KEYPAD_TABLE
00000005: 0024  ;     ASCII_TABLE_POINTER:        DEFW ASCII_TABLE
00000006: 006A  ;     POSITION_TABLE_POINTER:     DEFW POSITION_TABLE
00000007: 007B  ;     VARIABLES_TABLE_POINTER:    DEFW VARIABLES_TABLE
00000008: 008B  ;     TABLE_POINTERS:             DEFW JUMP_TABLE
00000009: 00CE  ;     BRANCHES_POINTER:           DEFW BRANCHES_TABLE
0000000A: 0026  ;     MESSAGE_TABLE_POINTER:      DEFW MSG_TABLE 
0000000B:       ; 
0000000B:       ; ; Root Table Accessors (Absolute Labels used with R0)
0000000B:       ; COLOURS             EQU COLOUR_TABLE_POINTER
0000000B:       ; ADDRESS             EQU ADDRESS_TABLE_POINTER
0000000B:       ; SOUND               EQU SOUND_TABLE_POINTER
0000000B:       ; KEYPAD              EQU KEYPAD_TABLE_POINTER
0000000B:       ; ASCII               EQU ASCII_TABLE_POINTER
0000000B:       ; POSITION            EQU POSITION_TABLE_POINTER
0000000B:       ; VARIABLES           EQU VARIABLES_TABLE_POINTER
0000000B:       ; JUMPTABLE           EQU TABLE_POINTERS
0000000B:       ; BRANCH              EQU BRANCHES_POINTER
0000000B:       ; MESSAGE             EQU MESSAGE_TABLE_POINTER
0000000B:       ; 
0000000B:       ; ; ==============================================================================
0000000B:       ; ; COLOUR TABLE
0000000B:       ; ; ==============================================================================
0000000B:       ; COLOUR_TABLE:
0000000B: 00FF  ;     WHITE_COLOR: DEFW 0xFF
0000000C: 00E0  ;     RED_COLOR:   DEFW 0x00E0
0000000D: 0000  ;     BLACK_COLOR: DEFW 0x00
0000000E: 001C  ;     GREEN_COLOR: DEFW 0x001C 
0000000F:       ; 
0000000F:       ; ; Offsets
0000000F:       ; WHITE_OFF EQU (WHITE_COLOR - COLOUR_TABLE)
0000000F:       ; RED_OFF   EQU (RED_COLOR - COLOUR_TABLE)
0000000F:       ; BLACK_OFF EQU (BLACK_COLOR - COLOUR_TABLE)
0000000F:       ; GREEN_OFF EQU (GREEN_COLOR - COLOUR_TABLE)
0000000F:       ; 
0000000F:       ; ; ==============================================================================
0000000F:       ; ; ADDRESS TABLE
0000000F:       ; ; ==============================================================================
0000000F:       ; ADDRESS_TABLE:
0000000F: FF00  ;     MATRIX_BASE_ADDR: DEFW 0xFF00
00000010: FF3F  ;     MATRIX_END_ADDR:  DEFW 0xFF3F
00000011: FF40  ;     LCD_START:        DEFW 0xFF40
00000012: FF92  ;     SOUND_ADDR:       DEFW 0xFF92
00000013: FF94  ;     KEYPAD_ADDR:      DEFW 0xFF94
00000014: FFA4  ;     FRC_ADDR:         DEFW 0xFFA4
00000015: FF95  ;     SW_SWITCH_ADDR:   DEFW 0xFF95
00000016: FF97  ;     SW_LED_ADDR:      DEFW 0xFF97
00000017:       ; 
00000017:       ; ; Offsets
00000017:       ; MAT_BASE_OFF   EQU (MATRIX_BASE_ADDR - ADDRESS_TABLE)
00000017:       ; MAT_END_OFF    EQU (MATRIX_END_ADDR - ADDRESS_TABLE)
00000017:       ; LCD_START_OFF  EQU (LCD_START - ADDRESS_TABLE)
00000017:       ; SOUND_ADDR_OFF EQU (SOUND_ADDR - ADDRESS_TABLE)
00000017:       ; KEY_ADDR_OFF   EQU (KEYPAD_ADDR - ADDRESS_TABLE)
00000017:       ; FRC_ADDR_OFF   EQU (FRC_ADDR - ADDRESS_TABLE)
00000017:       ; SW_SWITCH_ADDR_OFF EQU (SW_SWITCH_ADDR   - ADDRESS_TABLE)
00000017:       ; SW_LED_ADDR_OFF EQU (SW_LED_ADDR     - ADDRESS_TABLE)
00000017:       ; 
00000017:       ; 
00000017:       ; ; ==============================================================================
00000017:       ; ; SOUND TABLE
00000017:       ; ; ==============================================================================
00000017:       ; SOUND_TABLE:
00000017: 8147  ;     G_NOTE:      DEFW 0x8147
00000018: 8444  ;     NOTE2:       DEFW 0x8444
00000019: 0000  ;     T_R1_SAVE:   DEFW 0x0000
0000001A: 0000  ;     T_R2_SAVE:   DEFW 0x0000
0000001B: 003F  ;     MASK_6BITS:  DEFW 0x003F
0000001C: 0040  ;     value64:     DEFW 64
0000001D: 006A  ;     LED_L_PAT:   DEFW 0x006A
0000001E:       ; 
0000001E:       ; ; Offsets
0000001E:       ; G_NOTE_OFF      EQU (G_NOTE - SOUND_TABLE)
0000001E:       ; NOTE2_OFF       EQU (NOTE2 - SOUND_TABLE)
0000001E:       ; T_R1_SAVE_OFF   EQU (T_R1_SAVE - SOUND_TABLE)
0000001E:       ; T_R2_SAVE_OFF   EQU (T_R2_SAVE - SOUND_TABLE)
0000001E:       ; MASK_6BITS_OFF  EQU (MASK_6BITS - SOUND_TABLE)
0000001E:       ; VALUE_64_OFFSET EQU (value64 - SOUND_TABLE)
0000001E:       ; LED_L_PAT_OFF   EQU (LED_L_PAT   - SOUND_TABLE)
0000001E:       ; 
0000001E:       ; ; ==============================================================================
0000001E:       ; ; KEYPAD TABLE
0000001E:       ; ; ==============================================================================
0000001E:       ; KEYPAD_TABLE:
0000001E: 0100  ;     KEYPAD_8:      DEFW 0x0100 ; DOWN
0000001F: 0004  ;     KEYPAD_2:      DEFW 0x0004 ; UP
00000020: 0010  ;     KEYPAD_4:      DEFW 0x0010 ; LEFT
00000021: 0040  ;     KEYPAD_6:      DEFW 0x0040 ; RIGHT
00000022: 0020  ;     KEYPAD_5:      DEFW 0x0020 ; SELECT/STORE
00000023: 0800  ;     KEYPAD_FINISH: DEFW 0x0800 ; '#' / PASSED
00000024:       ; 
00000024:       ; ; Offsets
00000024:       ; KEY_DOWN_OFF   EQU (KEYPAD_8 - KEYPAD_TABLE)
00000024:       ; KEY_UP_OFF     EQU (KEYPAD_2 - KEYPAD_TABLE)
00000024:       ; KEY_LEFT_OFF   EQU (KEYPAD_4 - KEYPAD_TABLE)
00000024:       ; KEY_RIGHT_OFF  EQU (KEYPAD_6 - KEYPAD_TABLE)
00000024:       ; KEY_SELECT_OFF EQU (KEYPAD_5 - KEYPAD_TABLE)
00000024:       ; KEY_PASS_OFF   EQU (KEYPAD_FINISH - KEYPAD_TABLE)
00000024:       ; 
00000024:       ; ; ==============================================================================
00000024:       ; ; ASCII TABLE
00000024:       ; ; ==============================================================================
00000024:       ; ASCII_TABLE:
00000024: 0050  ;     ASCII_P: DEFW 0x50      ; 'P'
00000025: 0030  ;     ASCII_0: DEFW 0x30      ; '0'
00000026:       ; 
00000026:       ; ASCII_P_OFF EQU (ASCII_P - ASCII_TABLE)
00000026:       ; ASCII_0_OFF EQU (ASCII_0 - ASCII_TABLE)
00000026:       ; 
00000026:       ; ; ==============================================================================
00000026:       ; ; MESSAGE TABLE (Intro / text)
00000026:       ; ; ==============================================================================
00000026:       ; 
00000026:       ; MSG_TABLE:
00000026: 002F  ;     MSG_START_PTR:     DEFW PIXEL_MSG        ; pointer to first character
00000027: 004B  ;     MSG_END_PTR:       DEFW PIXEL_MSG_END    ; pointer one past last character
00000028: 002F  ;     MSG_SCROLL_PTR:    DEFW PIXEL_MSG        ; (legacy – not used by new intro)
00000029: 0040  ;     MSG_LOOP_COUNT:    DEFW 64               ; (legacy – not used by new intro)
0000002A: 0004  ;     MSG_ROWS:          DEFW 4                ; number of LCD rows
0000002B: 0014  ;     MSG_COLS:          DEFW 20               ; number of columns per row
0000002C:       ; 
0000002C: 004B  ;     PIXEL_WORD_PTR:    DEFW WORD_PIXEL       ; "PIXEL"
0000002D: 0050  ;     PUZZLE_WORD_PTR:   DEFW WORD_PUZZLE      ; "PUZZLE"
0000002E: 0056  ;     PRESS_PTR:         DEFW PRESS_MSG        ; bottom-row prompt
0000002F:       ; 
0000002F:       ; ; Message: "        PIXEL PUZZLE        "  (kept for convenience)
0000002F:       ; PIXEL_MSG:
0000002F: 0020  ;     DEFW 0x20    ; ' '
00000030: 0020  ;     DEFW 0x20
00000031: 0020  ;     DEFW 0x20
00000032: 0020  ;     DEFW 0x20
00000033: 0020  ;     DEFW 0x20
00000034: 0020  ;     DEFW 0x20
00000035: 0020  ;     DEFW 0x20
00000036: 0020  ;     DEFW 0x20
00000037: 0050  ;     DEFW 0x50    ; 'P'
00000038: 0049  ;     DEFW 0x49    ; 'I'
00000039: 0058  ;     DEFW 0x58    ; 'X'
0000003A: 0045  ;     DEFW 0x45    ; 'E'
0000003B: 004C  ;     DEFW 0x4C    ; 'L'
0000003C: 0020  ;     DEFW 0x20    ; ' '
0000003D: 0050  ;     DEFW 0x50    ; 'P'
0000003E: 0055  ;     DEFW 0x55    ; 'U'
0000003F: 005A  ;     DEFW 0x5A    ; 'Z'
00000040: 005A  ;     DEFW 0x5A    ; 'Z'
00000041: 004C  ;     DEFW 0x4C    ; 'L'
00000042: 0045  ;     DEFW 0x45    ; 'E'
00000043: 0020  ;     DEFW 0x20    ; ' '
00000044: 0020  ;     DEFW 0x20
00000045: 0020  ;     DEFW 0x20
00000046: 0020  ;     DEFW 0x20
00000047: 0020  ;     DEFW 0x20
00000048: 0020  ;     DEFW 0x20
00000049: 0020  ;     DEFW 0x20
0000004A: 0020  ;     DEFW 0x20
0000004B:       ; PIXEL_MSG_END:
0000004B:       ; 
0000004B:       ; ; "PIXEL"
0000004B:       ; WORD_PIXEL:
0000004B: 0050  ;     DEFW 0x50  ; 'P'
0000004C: 0049  ;     DEFW 0x49  ; 'I'
0000004D: 0058  ;     DEFW 0x58  ; 'X'
0000004E: 0045  ;     DEFW 0x45  ; 'E'
0000004F: 004C  ;     DEFW 0x4C  ; 'L'
00000050:       ; 
00000050:       ; ; "PUZZLE"
00000050:       ; WORD_PUZZLE:
00000050: 0050  ;     DEFW 0x50  ; 'P'
00000051: 0055  ;     DEFW 0x55  ; 'U'
00000052: 005A  ;     DEFW 0x5A  ; 'Z'
00000053: 005A  ;     DEFW 0x5A  ; 'Z'
00000054: 004C  ;     DEFW 0x4C  ; 'L'
00000055: 0045  ;     DEFW 0x45  ; 'E'
00000056:       ; 
00000056:       ; ; "PRESS ANY KEY       "  (exactly 20 chars for the bottom row)
00000056:       ; PRESS_MSG:
00000056: 0050  ;     DEFW 0x50  ; 'P'
00000057: 0052  ;     DEFW 0x52  ; 'R'
00000058: 0045  ;     DEFW 0x45  ; 'E'
00000059: 0053  ;     DEFW 0x53  ; 'S'
0000005A: 0053  ;     DEFW 0x53  ; 'S'
0000005B: 0020  ;     DEFW 0x20  ; ' '
0000005C: 0041  ;     DEFW 0x41  ; 'A'
0000005D: 004E  ;     DEFW 0x4E  ; 'N'
0000005E: 0059  ;     DEFW 0x59  ; 'Y'
0000005F: 0020  ;     DEFW 0x20  ; ' '
00000060: 004B  ;     DEFW 0x4B  ; 'K'
00000061: 0045  ;     DEFW 0x45  ; 'E'
00000062: 0059  ;     DEFW 0x59  ; 'Y'
00000063: 0020  ;     DEFW 0x20  ; ' '
00000064: 0020  ;     DEFW 0x20  ; ' '
00000065: 0020  ;     DEFW 0x20  ; ' '
00000066: 0020  ;     DEFW 0x20  ; ' '
00000067: 0020  ;     DEFW 0x20  ; ' '
00000068: 0020  ;     DEFW 0x20  ; ' '
00000069: 0020  ;     DEFW 0x20  ; ' '
0000006A:       ; 
0000006A:       ; ; Offsets inside MSG_TABLE
0000006A:       ; MSG_START_OFF        EQU (MSG_START_PTR      - MSG_TABLE)
0000006A:       ; MSG_END_OFF          EQU (MSG_END_PTR        - MSG_TABLE)
0000006A:       ; MSG_SCROLL_PTR_OFF   EQU (MSG_SCROLL_PTR     - MSG_TABLE)
0000006A:       ; MSG_LOOP_COUNT_OFF   EQU (MSG_LOOP_COUNT     - MSG_TABLE)
0000006A:       ; MSG_ROWS_OFF         EQU (MSG_ROWS           - MSG_TABLE)
0000006A:       ; MSG_COLS_OFF         EQU (MSG_COLS           - MSG_TABLE)
0000006A:       ; PIXEL_WORD_PTR_OFF   EQU (PIXEL_WORD_PTR     - MSG_TABLE)
0000006A:       ; PUZZLE_WORD_PTR_OFF  EQU (PUZZLE_WORD_PTR    - MSG_TABLE)
0000006A:       ; PRESS_PTR_OFF        EQU (PRESS_PTR          - MSG_TABLE)
0000006A:       ; 
0000006A:       ; 
0000006A:       ; 
0000006A:       ; 
0000006A:       ; 
0000006A:       ; 
0000006A:       ; ; ==============================================================================
0000006A:       ; ; POSITION TABLE
0000006A:       ; ; ==============================================================================
0000006A:       ; POSITION_TABLE:
0000006A: FF1B  ;     CURRENT_POS:    DEFW 0xFF1B
0000006B: FF0F  ;     BOUND1:         DEFW 0xFF0F
0000006C: FF1F  ;     BOUND2:         DEFW 0xFF1F
0000006D: FF2F  ;     BOUND3:         DEFW 0xFF2F
0000006E: 008E  ;     POINTER_POS1:   DEFW POS_0
0000006F: 009E  ;     POINTER_POS2:   DEFW POS_16
00000070: 00AE  ;     POINTER_POS3:   DEFW POS_32
00000071: 00BE  ;     POINTER_POS4:   DEFW POS_48
00000072: FF00  ;     LOWER_BOUND1:   DEFW 0xFF00
00000073: FF10  ;     LOWER_BOUND2:   DEFW 0xFF10
00000074: FF20  ;     LOWER_BOUND3:   DEFW 0xFF20
00000075: FF30  ;     LOWER_BOUND4:   DEFW 0xFF30
00000076: 00DD  ;     POINTER2_POS1:  DEFW POS2_0
00000077: 00ED  ;     POINTER2_POS2:  DEFW POS2_16
00000078: 00FD  ;     POINTER2_POS3:  DEFW POS2_32
00000079: 010D  ;     POINTER2_POS4:  DEFW POS2_48
0000007A:       ; 
0000007A:       ; ; Offsets
0000007A:       ; POS_CURRENT_OFF      EQU (CURRENT_POS - POSITION_TABLE)
0000007A:       ; POS_BOUND1_OFF       EQU (BOUND1 - POSITION_TABLE)
0000007A:       ; POS_BOUND2_OFF       EQU (BOUND2 - POSITION_TABLE)
0000007A:       ; POS_BOUND3_OFF       EQU (BOUND3 - POSITION_TABLE)
0000007A:       ; POS_PTR1_OFF         EQU (POINTER_POS1 - POSITION_TABLE)
0000007A:       ; POS_PTR2_OFF         EQU (POINTER_POS2 - POSITION_TABLE)
0000007A:       ; POS_PTR3_OFF         EQU (POINTER_POS3 - POSITION_TABLE)
0000007A:       ; POS_PTR4_OFF         EQU (POINTER_POS4 - POSITION_TABLE)
0000007A:       ; POS_LOWER1_OFF       EQU (LOWER_BOUND1 - POSITION_TABLE)
0000007A:       ; POS_LOWER2_OFF       EQU (LOWER_BOUND2 - POSITION_TABLE)
0000007A:       ; POS_LOWER3_OFF       EQU (LOWER_BOUND3 - POSITION_TABLE)
0000007A:       ; POS_LOWER4_OFF       EQU (LOWER_BOUND4 - POSITION_TABLE)
0000007A:       ; POS_PTR2_POS1_OFF    EQU (POINTER2_POS1 - POSITION_TABLE)
0000007A:       ; POS_PTR2_POS2_OFF    EQU (POINTER2_POS2 - POSITION_TABLE)
0000007A:       ; POS_PTR2_POS3_OFF    EQU (POINTER2_POS3 - POSITION_TABLE)
0000007A:       ; POS_PTR2_POS4_OFF    EQU (POINTER2_POS4 - POSITION_TABLE)
0000007A:       ; 
0000007A:       ; SEL_POS_TABLE EQU (POINTER_POS1 - POSITION_TABLE)
0000007A:       ; LEV_POS_TABLE EQU (POINTER2_POS1 - POSITION_TABLE)
0000007A:       ; 
0000007A:       ; REET:
0000007A: F061  ;     B REST
0000007B:       ; 
0000007B:       ; ; ==============================================================================
0000007B:       ; ; VARIABLES TABLE
0000007B:       ; ; ==============================================================================
0000007B:       ; VARIABLES_TABLE:
0000007B: 0FFF  ;     OUTER_COUNT:   DEFW 0x0FFF
0000007C: 0004  ;     INNER_COUNT:   DEFW 0x0004
0000007D: FF00  ;     LOWER_BOUND:   DEFW 0xFF00
0000007E: FF3F  ;     UPPER_BOUND:   DEFW 0xFF3F
0000007F: 008E  ;     POINTER_POS:   DEFW POS_0
00000080: 0001  ;     ONE:           DEFW 0x0001
00000081: 0000  ;     ZERO:          DEFW 0x00
00000082: 00A1  ;     UPBRANCH1:     DEFW 0x00A1
00000083: 00A2  ;     UPBRANCH2:     DEFW 0x00A2
00000084: 00B1  ;     LEFTBRANCH1:   DEFW 0x00B1
00000085: 00B2  ;     LEFTBRANCH2:   DEFW 0x00B2
00000086: 00C1  ;     RIGHTBRANCH1:  DEFW 0x00C1
00000087: 00C2  ;     RIGHTBRANCH2:  DEFW 0x00C2
00000088: 00D1  ;     DOWNBRANCH1:   DEFW 0x00D1
00000089: 00D2  ;     DOWNBRANCH2:   DEFW 0x00D2
0000008A: 0001  ;     LEVEL_COUNTER: DEFW 0x0001
0000008B:       ; 
0000008B:       ; ; Offsets
0000008B:       ; VAR_OUTER_OFF      EQU (OUTER_COUNT - VARIABLES_TABLE)
0000008B:       ; VAR_INNER_OFF      EQU (INNER_COUNT - VARIABLES_TABLE)
0000008B:       ; VAR_LOWER_OFF      EQU (LOWER_BOUND - VARIABLES_TABLE)
0000008B:       ; VAR_UPPER_OFF      EQU (UPPER_BOUND - VARIABLES_TABLE)
0000008B:       ; VAR_PTR_OFF        EQU (POINTER_POS - VARIABLES_TABLE)
0000008B:       ; VAR_ONE_OFF        EQU (ONE - VARIABLES_TABLE)
0000008B:       ; VAR_ZERO_OFF       EQU (ZERO - VARIABLES_TABLE)
0000008B:       ; VAR_UP1_OFF        EQU (UPBRANCH1 - VARIABLES_TABLE)
0000008B:       ; VAR_UP2_OFF        EQU (UPBRANCH2 - VARIABLES_TABLE)
0000008B:       ; VAR_LEFT1_OFF      EQU (LEFTBRANCH1 - VARIABLES_TABLE)
0000008B:       ; VAR_LEFT2_OFF      EQU (LEFTBRANCH2 - VARIABLES_TABLE)
0000008B:       ; VAR_RIGHT1_OFF     EQU (RIGHTBRANCH1 - VARIABLES_TABLE)
0000008B:       ; VAR_RIGHT2_OFF     EQU (RIGHTBRANCH2 - VARIABLES_TABLE)
0000008B:       ; VAR_DOWN1_OFF      EQU (DOWNBRANCH1 - VARIABLES_TABLE)
0000008B:       ; VAR_DOWN2_OFF      EQU (DOWNBRANCH2 - VARIABLES_TABLE)
0000008B:       ; VAR_LEVEL_CNT_OFF  EQU (LEVEL_COUNTER - VARIABLES_TABLE)
0000008B:       ; 
0000008B:       ; 
0000008B:       ; ; ==============================================================================
0000008B:       ; ; JUMP TABLE
0000008B:       ; ; ==============================================================================
0000008B:       ; JUMP_TABLE:
0000008B: 0243  ;     NEAR_JUMP: DEFW NEAR_UPDATE_CURRENT
0000008C: 011D  ;     RESET1:    DEFW RESET
0000008D: 01D3  ;     LEVEL1_J:  DEFW LEVEL1       ; new entry
0000008E:       ; 
0000008E:       ; JUMP_NEAR_OFF  EQU (NEAR_JUMP  - JUMP_TABLE)
0000008E:       ; JUMP_RST_OFF   EQU (RESET1     - JUMP_TABLE)
0000008E:       ; JUMP_LVL1_OFF  EQU (LEVEL1_J   - JUMP_TABLE)
0000008E:       ; 
0000008E:       ; 
0000008E:       ; ; ==============================================================================
0000008E:       ; ; SELECTED POSITIONS TABLES
0000008E:       ; ; ==============================================================================
0000008E:       ; SELECTED_POSITIONS_TABLE:
0000008E: 0000  ;     POS_0:   DEFW 0
0000008F: 0000  ;     POS_1:   DEFW 0
00000090: 0000  ;     POS_2:   DEFW 0
00000091: 0000  ;     POS_3:   DEFW 0
00000092: 0000  ;     POS_4:   DEFW 0
00000093: 0000  ;     POS_5:   DEFW 0
00000094: 0000  ;     POS_6:   DEFW 0
00000095: 0000  ;     POS_7:   DEFW 0
00000096: 0000  ;     POS_8:   DEFW 0
00000097: 0000  ;     POS_9:   DEFW 0
00000098: 0000  ;     POS_10:  DEFW 0
00000099: 0000  ;     POS_11:  DEFW 0
0000009A: 0000  ;     POS_12:  DEFW 0
0000009B: 0000  ;     POS_13:  DEFW 0
0000009C: 0000  ;     POS_14:  DEFW 0
0000009D: 0000  ;     POS_15:  DEFW 0
0000009E:       ; 
0000009E:       ; SELECTED_POSITIONS_TABLE2:
0000009E: 0000  ;     POS_16:  DEFW 0
0000009F: 0000  ;     POS_17:  DEFW 0
000000A0: 0000  ;     POS_18:  DEFW 0
000000A1: 0000  ;     POS_19:  DEFW 0
000000A2: 0000  ;     POS_20:  DEFW 0
000000A3: 0000  ;     POS_21:  DEFW 0
000000A4: 0000  ;     POS_22:  DEFW 0
000000A5: 0000  ;     POS_23:  DEFW 0
000000A6: 0000  ;     POS_24:  DEFW 0
000000A7: 0000  ;     POS_25:  DEFW 0
000000A8: 0000  ;     POS_26:  DEFW 0
000000A9: 0000  ;     POS_27:  DEFW 0
000000AA: 0000  ;     POS_28:  DEFW 0
000000AB: 0000  ;     POS_29:  DEFW 0
000000AC: 0000  ;     POS_30:  DEFW 0
000000AD: 0000  ;     POS_31:  DEFW 0
000000AE:       ; 
000000AE:       ; SELECTED_POSITIONS_TABLE3:
000000AE: 0000  ;     POS_32:  DEFW 0
000000AF: 0000  ;     POS_33:  DEFW 0
000000B0: 0000  ;     POS_34:  DEFW 0
000000B1: 0000  ;     POS_35:  DEFW 0
000000B2: 0000  ;     POS_36:  DEFW 0
000000B3: 0000  ;     POS_37:  DEFW 0
000000B4: 0000  ;     POS_38:  DEFW 0
000000B5: 0000  ;     POS_39:  DEFW 0
000000B6: 0000  ;     POS_40:  DEFW 0
000000B7: 0000  ;     POS_41:  DEFW 0
000000B8: 0000  ;     POS_42:  DEFW 0
000000B9: 0000  ;     POS_43:  DEFW 0
000000BA: 0000  ;     POS_44:  DEFW 0
000000BB: 0000  ;     POS_45:  DEFW 0
000000BC: 0000  ;     POS_46:  DEFW 0
000000BD: 0000  ;     POS_47:  DEFW 0
000000BE:       ; 
000000BE:       ; SELECTED_POSITIONS_TABLE4:
000000BE: 0000  ;     POS_48:  DEFW 0
000000BF: 0000  ;     POS_49:  DEFW 0
000000C0: 0000  ;     POS_50:  DEFW 0
000000C1: 0000  ;     POS_51:  DEFW 0
000000C2: 0000  ;     POS_52:  DEFW 0
000000C3: 0000  ;     POS_53:  DEFW 0
000000C4: 0000  ;     POS_54:  DEFW 0
000000C5: 0000  ;     POS_55:  DEFW 0
000000C6: 0000  ;     POS_56:  DEFW 0
000000C7: 0000  ;     POS_57:  DEFW 0
000000C8: 0000  ;     POS_58:  DEFW 0
000000C9: 0000  ;     POS_59:  DEFW 0
000000CA: 0000  ;     POS_60:  DEFW 0
000000CB: 0000  ;     POS_61:  DEFW 0
000000CC: 0000  ;     POS_62:  DEFW 0
000000CD: 0000  ;     POS_63:  DEFW 0
000000CE:       ; 
000000CE:       ; ; ==============================================================================
000000CE:       ; ; BRANCHES TABLE
000000CE:       ; ; ==============================================================================
000000CE:       ; BRANCHES_TABLE:
000000CE: 0253  ;     WAIT1:         DEFW WAIT
000000CF: 038C  ;     CHECK1:        DEFW CHECK
000000D0: 0277  ;     UPBRANCH11:    DEFW UPBRANC1
000000D1: 0278  ;     UPBRANCH21:    DEFW UPBRANC2
000000D2: 0282  ;     UPBRANCH31:    DEFW UPBRANC3
000000D3: 0289  ;     LEFTBRANCH11:  DEFW LEFTBRANC1
000000D4: 028A  ;     LEFTBRANCH21:  DEFW LEFTBRANC2
000000D5: 0294  ;     LEFTBRANCH31:  DEFW LEFTBRANC3
000000D6: 02AD  ;     RIGHTBRANCH11: DEFW RIGHTBRANC1
000000D7: 02AE  ;     RIGHTBRANCH21: DEFW RIGHTBRANC2
000000D8: 02B8  ;     RIGHTBRANCH31: DEFW RIGHTBRANC3
000000D9: 029B  ;     DOWNBRANCH11:  DEFW DOWNBRANC1
000000DA: 029C  ;     DOWNBRANCH21:  DEFW DOWNBRANC2
000000DB: 02A6  ;     DOWNBRANCH31:  DEFW DOWNBRANC3
000000DC:       ; 
000000DC:       ; ; Offsets
000000DC:       ; BR_WAIT_OFF     EQU (WAIT1 - BRANCHES_TABLE)
000000DC:       ; BR_CHECK_OFF    EQU (CHECK1 - BRANCHES_TABLE)
000000DC:       ; BR_UP1_OFF      EQU (UPBRANCH11 - BRANCHES_TABLE)
000000DC:       ; BR_UP2_OFF      EQU (UPBRANCH21 - BRANCHES_TABLE)
000000DC:       ; BR_UP3_OFF      EQU (UPBRANCH31 - BRANCHES_TABLE)
000000DC:       ; BR_LEFT1_OFF    EQU (LEFTBRANCH11 - BRANCHES_TABLE)
000000DC:       ; BR_LEFT2_OFF    EQU (LEFTBRANCH21 - BRANCHES_TABLE)
000000DC:       ; BR_LEFT3_OFF    EQU (LEFTBRANCH31 - BRANCHES_TABLE)
000000DC:       ; BR_RIGHT1_OFF   EQU (RIGHTBRANCH11 - BRANCHES_TABLE)
000000DC:       ; BR_RIGHT2_OFF   EQU (RIGHTBRANCH21 - BRANCHES_TABLE)
000000DC:       ; BR_RIGHT3_OFF   EQU (RIGHTBRANCH31 - BRANCHES_TABLE)
000000DC:       ; BR_DOWN1_OFF    EQU (DOWNBRANCH11 - BRANCHES_TABLE)
000000DC:       ; BR_DOWN2_OFF    EQU (DOWNBRANCH21 - BRANCHES_TABLE)
000000DC:       ; BR_DOWN3_OFF    EQU (DOWNBRANCH31 - BRANCHES_TABLE)
000000DC:       ; 
000000DC:       ; REST:
000000DC: F040  ;     B RESET
000000DD:       ; 
000000DD:       ; ; ==============================================================================
000000DD:       ; ; LEVEL POSITIONS TABLES
000000DD:       ; ; ==============================================================================
000000DD:       ; LEVEL_POSITIONS_TABLE:
000000DD: 0000  ;     POS2_0:   DEFW 0
000000DE: 0000  ;     POS2_1:   DEFW 0
000000DF: 0000  ;     POS2_2:   DEFW 0
000000E0: 0000  ;     POS2_3:   DEFW 0
000000E1: 0000  ;     POS2_4:   DEFW 0
000000E2: 0000  ;     POS2_5:   DEFW 0
000000E3: 0000  ;     POS2_6:   DEFW 0
000000E4: 0000  ;     POS2_7:   DEFW 0
000000E5: 0000  ;     POS2_8:   DEFW 0
000000E6: 0000  ;     POS2_9:   DEFW 0
000000E7: 0000  ;     POS2_10:  DEFW 0
000000E8: 0000  ;     POS2_11:  DEFW 0
000000E9: 0000  ;     POS2_12:  DEFW 0
000000EA: 0000  ;     POS2_13:  DEFW 0
000000EB: 0000  ;     POS2_14:  DEFW 0
000000EC: 0000  ;     POS2_15:  DEFW 0
000000ED:       ; 
000000ED:       ; LEVEL_POSITIONS_TABLE2:
000000ED: 0000  ;     POS2_16:  DEFW 0
000000EE: 0000  ;     POS2_17:  DEFW 0
000000EF: 0000  ;     POS2_18:  DEFW 0
000000F0: 0000  ;     POS2_19:  DEFW 0
000000F1: 0000  ;     POS2_20:  DEFW 0
000000F2: 0000  ;     POS2_21:  DEFW 0
000000F3: 0000  ;     POS2_22:  DEFW 0
000000F4: 0000  ;     POS2_23:  DEFW 0
000000F5: 0000  ;     POS2_24:  DEFW 0
000000F6: 0000  ;     POS2_25:  DEFW 0
000000F7: 0000  ;     POS2_26:  DEFW 0
000000F8: 0000  ;     POS2_27:  DEFW 0
000000F9: 0000  ;     POS2_28:  DEFW 0
000000FA: 0000  ;     POS2_29:  DEFW 0
000000FB: 0000  ;     POS2_30:  DEFW 0
000000FC: 0000  ;     POS2_31:  DEFW 0
000000FD:       ; 
000000FD:       ; LEVEL_POSITIONS_TABLE3:
000000FD: 0000  ;     POS2_32:  DEFW 0
000000FE: 0000  ;     POS2_33:  DEFW 0
000000FF: 0000  ;     POS2_34:  DEFW 0
00000100: 0000  ;     POS2_35:  DEFW 0
00000101: 0000  ;     POS2_36:  DEFW 0
00000102: 0000  ;     POS2_37:  DEFW 0
00000103: 0000  ;     POS2_38:  DEFW 0
00000104: 0000  ;     POS2_39:  DEFW 0
00000105: 0000  ;     POS2_40:  DEFW 0
00000106: 0000  ;     POS2_41:  DEFW 0
00000107: 0000  ;     POS2_42:  DEFW 0
00000108: 0000  ;     POS2_43:  DEFW 0
00000109: 0000  ;     POS2_44:  DEFW 0
0000010A: 0000  ;     POS2_45:  DEFW 0
0000010B: 0000  ;     POS2_46:  DEFW 0
0000010C: 0000  ;     POS2_47:  DEFW 0
0000010D:       ; 
0000010D:       ; LEVEL_POSITIONS_TABLE4:
0000010D: 0000  ;     POS2_48:  DEFW 0
0000010E: 0000  ;     POS2_49:  DEFW 0
0000010F: 0000  ;     POS2_50:  DEFW 0
00000110: 0000  ;     POS2_51:  DEFW 0
00000111: 0000  ;     POS2_52:  DEFW 0
00000112: 0000  ;     POS2_53:  DEFW 0
00000113: 0000  ;     POS2_54:  DEFW 0
00000114: 0000  ;     POS2_55:  DEFW 0
00000115: 0000  ;     POS2_56:  DEFW 0
00000116: 0000  ;     POS2_57:  DEFW 0
00000117: 0000  ;     POS2_58:  DEFW 0
00000118: 0000  ;     POS2_59:  DEFW 0
00000119: 0000  ;     POS2_60:  DEFW 0
0000011A: 0000  ;     POS2_61:  DEFW 0
0000011B: 0000  ;     POS2_62:  DEFW 0
0000011C: 0000  ;     POS2_63:  DEFW 0
0000011D:       ; 
0000011D:       ; ; ==============================================================================
0000011D:       ; ; GAME LOGIC
0000011D:       ; ; ==============================================================================
0000011D:       ; 
0000011D:       ; 
0000011D:       ; ; ----------------------------------------------------------------------------------
0000011D:       ; ; PIXEL PUZZLES EXECUTION CYCLE
0000011D:       ; ; ----------------------------------------------------------------------------------
0000011D:       ; ;
0000011D:       ; ; -> [0] RESET/INIT SYSTEM -> [1] INIT DISPLAY -> [2] DISPLAYING LEVEL -> [3] ASSESSING USER INPUT
0000011D:       ; ;   ^                                                                                   |
0000011D:       ; ;   |                                                                                   |
0000011D:       ; ;   |                                                                                   V            
0000011D:       ; ; [6] OTHERWISE FAIL      <- [6] CHECK FOR WIN       <- [5] VERIFY          <- [4] DRAW PIXEL
0000011D:       ; ; 
0000011D:       ; ; +-----------------------------------------------------------------------------
0000011D:       ; ;
0000011D:       ; 
0000011D:       ; 
0000011D:       ; 
0000011D:       ; 
0000011D:       ; ; ==============================================================================
0000011D:       ; ; RESET
0000011D:       ; ; ==============================================================================
0000011D:       ; 
0000011D:       ; 
0000011D:       ; 
0000011D:       ; RESET:
0000011D: D102  ;     LD R1, [R0,#ADDRESS] ;MATRIX END ADDRESS
0000011E: D121  ;     LD R1, [R1,#MAT_END_OFF]
0000011F:       ; 
0000011F: D301  ;     LD R3, [R0, #COLOURS]
00000120: D362  ;     LD R3, [R3, #BLACK_OFF];BLACK COLOUR
00000121:       ; 
00000121: D202  ;     LD R2, [R0, #ADDRESS]
00000122: D240  ;     LD R2, [R2, #MAT_BASE_OFF];MATRIX BASE ADDRESS
00000123:       ; 
00000123:       ; LOOP:
00000123: DB40  ;     ST R3, [R2]
00000124: 1241  ;     ADD R2, R2, #1
00000125: 4844  ;     CMP R2, R1
00000126: F6FC  ;     BNE LOOP
00000127:       ; 
00000127: DB40  ;     ST R3, [R2]
00000128:       ; 
00000128: D107  ;     LD R1, [R0, #VARIABLES]
00000129: D12F  ;     LD R1, [R1, #VAR_LEVEL_CNT_OFF]
0000012A:       ; 
0000012A: D207  ;     LD R2, [R0, #VARIABLES]
0000012B: D245  ;     LD R2, [R2, #VAR_ONE_OFF]
0000012C:       ; 
0000012C: 4828  ;     CMP R1, R2
0000012D:       ; 
0000012D: F726  ;     BEQ INIT_DISPLAY
0000012E:       ; 
0000012E:       ;     ;need to reset all memory tables
0000012E:       ; 
0000012E: D106  ;     LD R1, [R0,#POSITION]
0000012F: D224  ;     LD R2, [R1,#SEL_POS_TABLE];r2 contains first element of the table from what the user selected
00000130: D32C  ;     LD R3, [R1,#LEV_POS_TABLE];r3 contains first element of the table from what the level selected
00000131:       ; 
00000131: D103  ;     LD R1, [R0,#SOUND]
00000132: D125  ;     LD r1, [r1,#VALUE_64_OFFSET] ;r1 = 64
00000133:       ; 
00000133:       ; ZERO_LOOP:
00000133: D840  ;     ST R0, [R2]
00000134: D860  ;     ST R0, [R3]
00000135: 1241  ;     ADD R2, R2, #1
00000136: 1361  ;     ADD R3, R3, #1 
00000137: 5921  ;     SUBS R1, R1, #1
00000138: F701  ;     BEQ INIT_DISPLAY2
00000139: F0F9  ;     BAL ZERO_LOOP
0000013A:       ; 
0000013A:       ; 
0000013A:       ; 
0000013A:       ; 
0000013A:       ; 
0000013A:       ; 
0000013A:       ; ; ==============================================================================
0000013A:       ; ; INIT DISPLAY
0000013A:       ; ; ==============================================================================
0000013A:       ; 
0000013A:       ; 
0000013A:       ; ;this is our LCD display for when the level is greater than 1, so when it shows the levels e.g. 2, 3,
                ;  4, etc
0000013A:       ; INIT_DISPLAY2:
0000013A:       ;     ; --------------------------------------
0000013A:       ;     ; Clear entire LCD and show current level
0000013A:       ;     ; --------------------------------------
0000013A:       ; 
0000013A:       ;     ; R3 = ' ' (space) from PIXEL_MSG[0]
0000013A: D10A  ;     LD  R1, [R0, #MESSAGE]
0000013B: D320  ;     LD  R3, [R1, #MSG_START_OFF]   ; R3 = &PIXEL_MSG
0000013C: D360  ;     LD  R3, [R3]                   ; first char = 0x20 (' ')
0000013D:       ; 
0000013D:       ;     ; R6 = LCD start address
0000013D: D602  ;     LD  R6, [R0, #ADDRESS]
0000013E: D6C2  ;     LD  R6, [R6, #LCD_START_OFF]
0000013F:       ; 
0000013F:       ;     ; R1 = row counter = MSG_ROWS
0000013F: D10A  ;     LD  R1, [R0, #MESSAGE]
00000140: D124  ;     LD  R1, [R1, #MSG_ROWS_OFF]
00000141:       ; 
00000141:       ; INIT2_CLR_ROWS:
00000141:       ;     ; R5 = column counter = MSG_COLS
00000141: D20A  ;     LD  R2, [R0, #MESSAGE]
00000142: D545  ;     LD  R5, [R2, #MSG_COLS_OFF]
00000143:       ; 
00000143:       ; INIT2_CLR_COLS:
00000143: DBC0  ;     ST  R3, [R6]                   ; write space
00000144: 16C1  ;     ADD R6, R6, #1
00000145: 5DA1  ;     SUBS R5, R5, #1
00000146: F6FC  ;     BNE INIT2_CLR_COLS
00000147:       ; 
00000147: 5921  ;     SUBS R1, R1, #1
00000148: F6F8  ;     BNE INIT2_CLR_ROWS
00000149:       ; 
00000149:       ;     ; --------------------------------------
00000149:       ;     ; Now show the current level number
00000149:       ;     ; --------------------------------------
00000149:       ; 
00000149:       ;     ; R3 = LEVEL_COUNTER (1,2,3,...)
00000149: D307  ;     LD  R3, [R0, #VARIABLES]
0000014A: D36F  ;     LD  R3, [R3, #VAR_LEVEL_CNT_OFF]
0000014B:       ; 
0000014B:       ;     ; R1 = ASCII '0'
0000014B: D105  ;     LD  R1, [R0, #ASCII]
0000014C: D121  ;     LD  R1, [R1, #ASCII_0_OFF]
0000014D:       ; 
0000014D:       ;     ; R3 = '0' + LEVEL_COUNTER -> '1','2',...
0000014D: 0364  ;     ADD R3, R3, R1
0000014E:       ; 
0000014E:       ;     ; R2 = LCD start address again
0000014E: D202  ;     LD  R2, [R0, #ADDRESS]
0000014F: D242  ;     LD  R2, [R2, #LCD_START_OFF]
00000150:       ; 
00000150:       ;     ; Put digit in first character cell (row 0, col 0)
00000150: DB40  ;     ST  R3, [R2]
00000151:       ; 
00000151:       ;     ; --------------------------------------
00000151:       ;     ; Long jump to LEVEL1 via jump table
00000151:       ;     ; --------------------------------------
00000151: D108  ;     LD  R1, [R0, #JUMPTABLE]
00000152: D122  ;     LD  R1, [R1, #JUMP_LVL1_OFF]
00000153: 0720  ;     ADD R7, R1, R0
00000154:       ; 
00000154:       ; 
00000154:       ; 
00000154:       ; 
00000154:       ; 
00000154:       ; 
00000154:       ; ;this is our LCD display for when the level is 1, we need to show the pixel puzzle name, show press a
                ; ny key, then start the game
00000154:       ; INIT_DISPLAY:
00000154:       ; 
00000154:       ;     ; ---------------------------------------------
00000154:       ;     ; 0) Get a SPACE character from PIXEL_MSG[0]
00000154:       ;     ;      R3 = ' '
00000154:       ;     ; ---------------------------------------------
00000154: D10A  ;     LD  R1, [R0, #MESSAGE]
00000155: D320  ;     LD  R3, [R1, #MSG_START_OFF]   ; R3 = &PIXEL_MSG
00000156: D360  ;     LD  R3, [R3]                   ; R3 = first char = 0x20 (space)
00000157:       ; 
00000157:       ;     ; ---------------------------------------------
00000157:       ;     ; 1) Clear entire LCD (MSG_ROWS x MSG_COLS)
00000157:       ;     ; ---------------------------------------------
00000157:       ; 
00000157:       ;     ; R6 = LCD start address
00000157: D602  ;     LD  R6, [R0, #ADDRESS]
00000158: D6C2  ;     LD  R6, [R6, #LCD_START_OFF]
00000159:       ; 
00000159:       ;     ; R1 = row counter = MSG_ROWS
00000159: D10A  ;     LD  R1, [R0, #MESSAGE]
0000015A: D124  ;     LD  R1, [R1, #MSG_ROWS_OFF]
0000015B:       ; 
0000015B:       ; INIT_CLR_ROWS:
0000015B:       ;     ; R5 = column counter = MSG_COLS
0000015B: D20A  ;     LD  R2, [R0, #MESSAGE]
0000015C: D545  ;     LD  R5, [R2, #MSG_COLS_OFF]
0000015D:       ; 
0000015D:       ; INIT_CLR_COLS:
0000015D: DBC0  ;     ST  R3, [R6]
0000015E: 16C1  ;     ADD R6, R6, #1
0000015F: 5DA1  ;     SUBS R5, R5, #1
00000160: F6FC  ;     BNE INIT_CLR_COLS
00000161:       ; 
00000161: 5921  ;     SUBS R1, R1, #1
00000162: F6F8  ;     BNE INIT_CLR_ROWS
00000163:       ; 
00000163:       ; 
00000163:       ;     ; ---------------------------------------------
00000163:       ;     ; 2) Row 0: "PIXEL" sweeps left -> right
00000163:       ;     ; ---------------------------------------------
00000163:       ; 
00000163:       ;     ; POS in R1 (start at 0)
00000163: 1100  ;     ADD R1, R0, #0
00000164:       ; 
00000164:       ; PIXEL_SWEEP_LOOP:
00000164:       ; 
00000164:       ;     ; Row 0 base in R4
00000164: D402  ;     LD  R4, [R0, #ADDRESS]
00000165: D482  ;     LD  R4, [R4, #LCD_START_OFF]
00000166:       ; 
00000166:       ;     ; Clear row 0 to spaces
00000166: D20A  ;     LD  R2, [R0, #MESSAGE]
00000167: D545  ;     LD  R5, [R2, #MSG_COLS_OFF]
00000168: 0680  ;     ADD R6, R4, R0           ; R6 = row0 pointer
00000169:       ; 
00000169:       ; PIXEL_CLR_ROW0:
00000169: DBC0  ;     ST  R3, [R6]
0000016A: 16C1  ;     ADD R6, R6, #1
0000016B: 5DA1  ;     SUBS R5, R5, #1
0000016C: F6FC  ;     BNE PIXEL_CLR_ROW0
0000016D:       ; 
0000016D:       ;     ; Destination pointer = row0 base + POS
0000016D: 0684  ;     ADD R6, R4, R1
0000016E:       ; 
0000016E:       ;     ; Copy 5 letters from WORD_PIXEL
0000016E: D20A  ;     LD  R2, [R0, #MESSAGE]
0000016F: D546  ;     LD  R5, [R2, #PIXEL_WORD_PTR_OFF]   ; R5 = &WORD_PIXEL
00000170: 1205  ;     ADD R2, R0, #5                      ; length = 5
00000171:       ; 
00000171:       ; PIXEL_COPY_LOOP:
00000171: D4A0  ;     LD  R4, [R5]
00000172: DCC0  ;     ST  R4, [R6]
00000173: 15A1  ;     ADD R5, R5, #1
00000174: 16C1  ;     ADD R6, R6, #1
00000175: 5A41  ;     SUBS R2, R2, #1
00000176: F6FA  ;     BNE PIXEL_COPY_LOOP
00000177:       ; 
00000177:       ;     ; Delay (OUTER x INNER)
00000177: D207  ;     LD  R2, [R0, #VARIABLES]
00000178: D540  ;     LD  R5, [R2, #VAR_OUTER_OFF]
00000179:       ; 
00000179:       ; PIXEL_DELAY_OUTER:
00000179: D207  ;     LD  R2, [R0, #VARIABLES]
0000017A: D641  ;     LD  R6, [R2, #VAR_INNER_OFF]
0000017B:       ; 
0000017B:       ; PIXEL_DELAY_INNER:
0000017B: 5EC1  ;     SUBS R6, R6, #1
0000017C: F6FE  ;     BNE  PIXEL_DELAY_INNER
0000017D:       ; 
0000017D: 5DA1  ;     SUBS R5, R5, #1
0000017E: F6FA  ;     BNE  PIXEL_DELAY_OUTER
0000017F:       ; 
0000017F:       ;     ; POS++ until COLS - 5
0000017F: D20A  ;     LD  R2, [R0, #MESSAGE]
00000180: D545  ;     LD  R5, [R2, #MSG_COLS_OFF]
00000181: 55A5  ;     SUB R5, R5, #5           ; max start = COLS - 5
00000182:       ; 
00000182: 4834  ;     CMP R1, R5
00000183: F702  ;     BEQ PIXEL_SWEEP_DONE
00000184:       ; 
00000184: 1121  ;     ADD R1, R1, #1
00000185: F0DE  ;     B   PIXEL_SWEEP_LOOP
00000186:       ; 
00000186:       ; PIXEL_SWEEP_DONE:
00000186:       ; 
00000186:       ; 
00000186:       ;     ; ---------------------------------------------
00000186:       ;     ; 3) Row 1: "PUZZLE" sweeps right -> left
00000186:       ;     ; ---------------------------------------------
00000186:       ; 
00000186:       ;     ; POS2 = COLS - 6 in R1
00000186: D20A  ;     LD  R2, [R0, #MESSAGE]
00000187: D545  ;     LD  R5, [R2, #MSG_COLS_OFF]
00000188: 51A6  ;     SUB R1, R5, #6
00000189:       ; 
00000189:       ; PUZZLE_SWEEP_LOOP:
00000189:       ; 
00000189:       ;     ; Row1 base = LCD_START + COLS
00000189: D402  ;     LD  R4, [R0, #ADDRESS]
0000018A: D482  ;     LD  R4, [R4, #LCD_START_OFF]      ; row0 base
0000018B:       ; 
0000018B: D20A  ;     LD  R2, [R0, #MESSAGE]
0000018C: D545  ;     LD  R5, [R2, #MSG_COLS_OFF]       ; COLS
0000018D: 0494  ;     ADD R4, R4, R5                    ; row1 base
0000018E:       ; 
0000018E:       ;     ; Clear row1
0000018E: D20A  ;     LD  R2, [R0, #MESSAGE]
0000018F: D545  ;     LD  R5, [R2, #MSG_COLS_OFF]
00000190: 0680  ;     ADD R6, R4, R0
00000191:       ; 
00000191:       ; PUZZLE_CLR_ROW1:
00000191: DBC0  ;     ST  R3, [R6]
00000192: 16C1  ;     ADD R6, R6, #1
00000193: 5DA1  ;     SUBS R5, R5, #1
00000194: F6FC  ;     BNE PUZZLE_CLR_ROW1
00000195:       ; 
00000195:       ;     ; Destination pointer = row1 base + POS2
00000195: 0684  ;     ADD R6, R4, R1
00000196:       ; 
00000196:       ;     ; Copy 6 letters from WORD_PUZZLE
00000196: D20A  ;     LD  R2, [R0, #MESSAGE]
00000197: D547  ;     LD  R5, [R2, #PUZZLE_WORD_PTR_OFF]
00000198: 1206  ;     ADD R2, R0, #6                     ; length = 6
00000199:       ; 
00000199:       ; PUZZLE_COPY_LOOP:
00000199: D4A0  ;     LD  R4, [R5]
0000019A: DCC0  ;     ST  R4, [R6]
0000019B: 15A1  ;     ADD R5, R5, #1
0000019C: 16C1  ;     ADD R6, R6, #1
0000019D: 5A41  ;     SUBS R2, R2, #1
0000019E: F6FA  ;     BNE PUZZLE_COPY_LOOP
0000019F:       ; 
0000019F:       ;     ; Delay (same OUTER x INNER)
0000019F: D207  ;     LD  R2, [R0, #VARIABLES]
000001A0: D540  ;     LD  R5, [R2, #VAR_OUTER_OFF]
000001A1:       ; 
000001A1:       ; PUZZLE_DELAY_OUTER:
000001A1: D207  ;     LD  R2, [R0, #VARIABLES]
000001A2: D641  ;     LD  R6, [R2, #VAR_INNER_OFF]
000001A3:       ; 
000001A3:       ; PUZZLE_DELAY_INNER:
000001A3: 5EC1  ;     SUBS R6, R6, #1
000001A4: F6FE  ;     BNE  PUZZLE_DELAY_INNER
000001A5:       ; 
000001A5: 5DA1  ;     SUBS R5, R5, #1
000001A6: F6FA  ;     BNE  PUZZLE_DELAY_OUTER
000001A7:       ; 
000001A7:       ;     ; POS2-- until 0
000001A7: 4820  ;     CMP R1, R0
000001A8: F702  ;     BEQ PUZZLE_SWEEP_DONE
000001A9:       ; 
000001A9: 5121  ;     SUB R1, R1, #1
000001AA: F0DE  ;     B   PUZZLE_SWEEP_LOOP
000001AB:       ; 
000001AB:       ; PUZZLE_SWEEP_DONE:
000001AB:       ; 
000001AB:       ; 
000001AB:       ;     ; ---------------------------------------------
000001AB:       ;     ; 4) Clear rows 0..2 (top three rows blank)
000001AB:       ;     ; ---------------------------------------------
000001AB:       ; 
000001AB:       ;     ; Row0 base in R6
000001AB: D602  ;     LD  R6, [R0, #ADDRESS]
000001AC: D6C2  ;     LD  R6, [R6, #LCD_START_OFF]
000001AD:       ; 
000001AD: D20A  ;     LD  R2, [R0, #MESSAGE]
000001AE: D545  ;     LD  R5, [R2, #MSG_COLS_OFF]   ; COLS
000001AF:       ; 
000001AF: 1103  ;     ADD R1, R0, #3                ; 3 rows (0,1,2)
000001B0:       ; 
000001B0:       ; CLEAR_TOP_ROWS:
000001B0: 04A0  ;     ADD R4, R5, R0                ; R4 = COLS (column counter)
000001B1:       ; 
000001B1:       ; CLEAR_TOP_COLS:
000001B1: DBC0  ;     ST  R3, [R6]                  ; space
000001B2: 16C1  ;     ADD R6, R6, #1
000001B3: 5C81  ;     SUBS R4, R4, #1
000001B4: F6FC  ;     BNE CLEAR_TOP_COLS
000001B5:       ; 
000001B5: 5921  ;     SUBS R1, R1, #1
000001B6: F6F9  ;     BNE CLEAR_TOP_ROWS
000001B7:       ; 
000001B7:       ; 
000001B7:       ;     ; ---------------------------------------------
000001B7:       ;     ; 5) Bottom row: "PRESS ANY KEY" and wait
000001B7:       ;     ; ---------------------------------------------
000001B7:       ; 
000001B7:       ;     ; Compute row3 base: LCD_START + 3 * COLS
000001B7:       ; 
000001B7: D602  ;     LD  R6, [R0, #ADDRESS]
000001B8: D6C2  ;     LD  R6, [R6, #LCD_START_OFF]  ; row0 base
000001B9:       ; 
000001B9: D20A  ;     LD  R2, [R0, #MESSAGE]
000001BA: D545  ;     LD  R5, [R2, #MSG_COLS_OFF]   ; COLS
000001BB:       ; 
000001BB: 04B4  ;     ADD R4, R5, R5                ; 2 * COLS
000001BC: 0494  ;     ADD R4, R4, R5                ; 3 * COLS
000001BD: 06D0  ;     ADD R6, R6, R4                ; R6 = row3 base
000001BE:       ; 
000001BE:       ;     ; Copy PRESS_MSG to row3
000001BE: D20A  ;     LD  R2, [R0, #MESSAGE]
000001BF: D148  ;     LD  R1, [R2, #PRESS_PTR_OFF]  ; R1 = &PRESS_MSG
000001C0: D445  ;     LD  R4, [R2, #MSG_COLS_OFF]   ; column counter
000001C1:       ; 
000001C1: 05C0  ;     ADD R5, R6, R0                ; dest pointer = row3 base
000001C2:       ; 
000001C2:       ; PRESS_COPY_LOOP:
000001C2: D320  ;     LD  R3, [R1]
000001C3: DBA0  ;     ST  R3, [R5]
000001C4: 1121  ;     ADD R1, R1, #1
000001C5: 15A1  ;     ADD R5, R5, #1
000001C6: 5C81  ;     SUBS R4, R4, #1
000001C7: F6FA  ;     BNE PRESS_COPY_LOOP
000001C8:       ; 
000001C8:       ;     ; Wait for any key press
000001C8:       ; WAIT_KEY_PRESS:
000001C8: D102  ;     LD  R1, [R0, #ADDRESS]
000001C9: D124  ;     LD  R1, [R1, #KEY_ADDR_OFF]
000001CA: D220  ;     LD  R2, [R1]
000001CB: 4840  ;     CMP R2, R0
000001CC: F7FB  ;     BEQ WAIT_KEY_PRESS            ; still no key
000001CD:       ; 
000001CD:       ;     ; Then wait for key release (so game doesnt see it as a move)
000001CD:       ; WAIT_KEY_RELEASE:
000001CD: D102  ;     LD  R1, [R0, #ADDRESS]
000001CE: D124  ;     LD  R1, [R1, #KEY_ADDR_OFF]
000001CF: D220  ;     LD  R2, [R1]
000001D0: 4840  ;     CMP R2, R0
000001D1: F6FB  ;     BNE WAIT_KEY_RELEASE
000001D2:       ; 
000001D2: F000  ;     B   LEVEL1
000001D3:       ; 
000001D3:       ; 
000001D3:       ; 
000001D3:       ; ; ==============================================================================
000001D3:       ; ; DISPLAYING LEVEL
000001D3:       ; ; ==============================================================================
000001D3:       ; 
000001D3:       ; 
000001D3:       ; 
000001D3:       ; LEVEL1:
000001D3:       ; 
000001D3:       ;     ; Get current level: how many pixels to show this level
000001D3: D607  ;     LD R6, [R0, #VARIABLES]
000001D4: D6CF  ;     LD R6, [R6, #VAR_LEVEL_CNT_OFF]    ; R6 = LEVEL_COUNTER (>= 1)
000001D5:       ; 
000001D5: F000  ;     B DISPLAY_LEVEL_PATTERN
000001D6:       ; 
000001D6:       ; 
000001D6:       ; 
000001D6:       ; ; --- Display and store winning pattern for current level ---
000001D6:       ; 
000001D6:       ; DISPLAY_LEVEL_PATTERN:
000001D6:       ; 
000001D6:       ;     ; If no pixels remaining, finish this level
000001D6: 48C0  ;     CMP R6, R0
000001D7: F74E  ;     BEQ FINISH_LEVEL_PATTERN
000001D8:       ; 
000001D8:       ; 
000001D8:       ; CHOOSE_RANDOM_PIXEL_FOR_LEVEL:
000001D8:       ; 
000001D8:       ;     ; -------------------------------------------------------------
000001D8:       ;     ; 1. Get a random matrix address using Free Running Counter FRC
000001D8:       ;     ; -------------------------------------------------------------
000001D8:       ; 
000001D8: D102  ;     LD R1, [R0, #ADDRESS]
000001D9: D125  ;     LD R1, [R1, #FRC_ADDR_OFF]         ; R1 = &FRC (&FFA4)
000001DA: D120  ;     LD R1, [R1]                        ; R1 = FRC value
000001DB:       ; 
000001DB: D203  ;     LD R2, [R0, #SOUND]
000001DC: D244  ;     LD R2, [R2, #MASK_6BITS_OFF]       ; R2 = 0x003F
000001DD: 8128  ;     AND R1, R1, R2                     ; R1 = random index 0..63
000001DE:       ; 
000001DE: D202  ;     LD R2, [R0, #ADDRESS]
000001DF: D240  ;     LD R2, [R2, #MAT_BASE_OFF]         ; R2 = MATRIX_BASE (&FF00)
000001E0: 0244  ;     ADD R2, R2, R1                     ; R2 = random matrix address (&FF00..&FF3F)
000001E1:       ; 
000001E1:       ;     ; Keep a copy of matrix address in R4 for mapping
000001E1: 0440  ;     MOV R4, R2
000001E2:       ; 
000001E2:       ; 
000001E2:       ; 
000001E2:       ;     ; -------------------------------------------------------------
000001E2:       ;     ; 2. Map matrix address to LEVEL_POSITIONS_TABLE entry (POS2_xx)
000001E2:       ;     ;    Use the same row/offset scheme as your STORE code.
000001E2:       ;     ; -------------------------------------------------------------
000001E2:       ; 
000001E2: D106  ;     LD R1, [R0, #POSITION]
000001E3: D121  ;     LD R1, [R1, #POS_BOUND1_OFF]       ; BOUND1 (0xFF0F)
000001E4: 4884  ;     CMP R4, R1
000001E5: FF09  ;     BLE LOAD_FIRST_POS_FOR_LEVEL
000001E6:       ; 
000001E6: D106  ;     LD R1, [R0, #POSITION]
000001E7: D122  ;     LD R1, [R1, #POS_BOUND2_OFF]       ; BOUND2 (0xFF1F)
000001E8: 4884  ;     CMP R4, R1
000001E9: FF0A  ;     BLE LOAD_SECOND_POS_FOR_LEVEL
000001EA:       ; 
000001EA: D106  ;     LD R1, [R0, #POSITION]
000001EB: D123  ;     LD R1, [R1, #POS_BOUND3_OFF]       ; BOUND3 (0xFF2F)
000001EC: 4884  ;     CMP R4, R1
000001ED: FF0B  ;     BLE LOAD_THIRD_POS_FOR_LEVEL
000001EE:       ; 
000001EE: F00F  ;     B LOAD_FOURTH_POS_FOR_LEVEL
000001EF:       ; 
000001EF:       ; 
000001EF:       ; 
000001EF:       ; ; --- Select which POS2 block (0..15 / 16..31 / 32..47 / 48..63) ---
000001EF:       ; 
000001EF:       ; ; On entry to each LOAD_*_POS_FOR_LEVEL:
000001EF:       ; ;   R4 = matrix address (&FF00..&FF3F)
000001EF:       ; ; On exit to AFTER_LOADING_POS_FOR_LEVEL:
000001EF:       ; ;   R3 = base pointer for POS2 block (POS2_0 / 16 / 32 / 48)
000001EF:       ; ;   R5 = lower bound address for that row (FF00 / FF10 / FF20 / FF30)
000001EF:       ; 
000001EF:       ; LOAD_FIRST_POS_FOR_LEVEL:
000001EF:       ; 
000001EF: D306  ;     LD R3, [R0, #POSITION]
000001F0: D36C  ;     LD R3, [R3, #POS_PTR2_POS1_OFF]    ; -> POS2_0
000001F1:       ; 
000001F1: D506  ;     LD R5, [R0, #POSITION]
000001F2: D5A8  ;     LD R5, [R5, #POS_LOWER1_OFF]       ; LOWER_BOUND1 (&FF00)
000001F3:       ; 
000001F3: F00F  ;     B AFTER_LOADING_POS_FOR_LEVEL
000001F4:       ; 
000001F4:       ; 
000001F4:       ; LOAD_SECOND_POS_FOR_LEVEL:
000001F4:       ; 
000001F4: D306  ;     LD R3, [R0, #POSITION]
000001F5: D36D  ;     LD R3, [R3, #POS_PTR2_POS2_OFF]    ; -> POS2_16
000001F6:       ; 
000001F6: D506  ;     LD R5, [R0, #POSITION]
000001F7: D5A9  ;     LD R5, [R5, #POS_LOWER2_OFF]       ; LOWER_BOUND2 (&FF10)
000001F8:       ; 
000001F8: F00A  ;     B AFTER_LOADING_POS_FOR_LEVEL
000001F9:       ; 
000001F9:       ; 
000001F9:       ; LOAD_THIRD_POS_FOR_LEVEL:
000001F9:       ; 
000001F9: D306  ;     LD R3, [R0, #POSITION]
000001FA: D36E  ;     LD R3, [R3, #POS_PTR2_POS3_OFF]    ; -> POS2_32
000001FB:       ; 
000001FB: D506  ;     LD R5, [R0, #POSITION]
000001FC: D5AA  ;     LD R5, [R5, #POS_LOWER3_OFF]       ; LOWER_BOUND3 (&FF20)
000001FD:       ; 
000001FD: F005  ;     B AFTER_LOADING_POS_FOR_LEVEL
000001FE:       ; 
000001FE:       ; 
000001FE:       ; LOAD_FOURTH_POS_FOR_LEVEL:
000001FE:       ; 
000001FE: D306  ;     LD R3, [R0, #POSITION]
000001FF: D36F  ;     LD R3, [R3, #POS_PTR2_POS4_OFF]    ; -> POS2_48
00000200:       ; 
00000200: D506  ;     LD R5, [R0, #POSITION]
00000201: D5AB  ;     LD R5, [R5, #POS_LOWER4_OFF]       ; LOWER_BOUND4 (&FF30)
00000202:       ; 
00000202: F000  ;     B AFTER_LOADING_POS_FOR_LEVEL
00000203:       ; 
00000203:       ; 
00000203:       ; 
00000203:       ; ; --- Compute offset within POS2 block, check duplicates, then store ---
00000203:       ; 
00000203:       ; AFTER_LOADING_POS_FOR_LEVEL:
00000203:       ; 
00000203:       ;     ; R4 = matrix address
00000203:       ;     ; R5 = lower bound for this row (FF00 / 10 / 20 / 30)
00000203:       ;     ; R3 = base pointer to POS2 block (POS2_0 / 16 / 32 / 48)
00000203:       ; 
00000203: 4594  ;     SUB R5, R4, R5                     ; R5 = offset 0..15 within row
00000204: 0374  ;     ADD R3, R3, R5                     ; R3 -> POS2_(blockStart + offset)
00000205:       ; 
00000205:       ;     ; Check if this level position is already used
00000205: D160  ;     LD R1, [R3]                        ; R1 = 0 or 1
00000206: 4820  ;     CMP R1, R0
00000207: F6D0  ;     BNE CHOOSE_RANDOM_PIXEL_FOR_LEVEL  ; duplicate → pick a new random pixel
00000208:       ; 
00000208:       ; 
00000208:       ; 
00000208:       ;     ; -------------------------------------------------------------
00000208:       ;     ; 3. Pixel is unique for this level: show it and store '1'
00000208:       ;     ; -------------------------------------------------------------
00000208:       ; 
00000208:       ;     ; Show red pixel at matrix address R2
00000208: D101  ;     LD R1, [R0, #COLOURS]
00000209: D121  ;     LD R1, [R1, #RED_OFF]              ; R1 = RED colour
0000020A: D940  ;     ST R1, [R2]
0000020B:       ; 
0000020B:       ;     ; Play note at SOUND_ADDR
0000020B: D103  ;     LD R1, [R0, #SOUND]
0000020C: D120  ;     LD R1, [R1, #G_NOTE_OFF]           ; R1 = G_NOTE
0000020D:       ; 
0000020D: D402  ;     LD R4, [R0, #ADDRESS]
0000020E: D483  ;     LD R4, [R4, #SOUND_ADDR_OFF]       ; R4 = SOUND_ADDR (&FF92)
0000020F: D980  ;     ST R1, [R4]
00000210:       ; 
00000210:       ;     ; Mark this position in LEVEL_POSITIONS_TABLE as '1'
00000210: D107  ;     LD R1, [R0, #VARIABLES]
00000211: D125  ;     LD R1, [R1, #VAR_ONE_OFF]          ; R1 = 1
00000212: D960  ;     ST R1, [R3]
00000213:       ; 
00000213:       ;     ; One fewer pixel remaining for this level
00000213: 5EC1  ;     SUBS R6, R6, #1
00000214:       ; 
00000214:       ;     ; Longish delay so the pattern is visible
00000214: F000  ;     B DELAY_LEVEL_DISPLAY
00000215:       ; 
00000215:       ; 
00000215:       ; 
00000215:       ; ; --- Delay routine (×4 OUTER/INNER loops) – preserves R6 ---
00000215:       ; 
00000215:       ; DELAY_LEVEL_DISPLAY:
00000215:       ; 
00000215:       ;     ; Build K = 4 in R5 using ONE constant (only small immediates)
00000215: D507  ;     LD R5, [R0, #VARIABLES]
00000216: D5A5  ;     LD R5, [R5, #VAR_ONE_OFF]          ; R5 = 1
00000217: 05B4  ;     ADD R5, R5, R5                     ; R5 = 2
00000218: 05B4  ;     ADD R5, R5, R5                     ; R5 = 4
00000219:       ; 
00000219:       ; LVL_DELAY_K_LOOP:
00000219:       ; 
00000219:       ;     ; Outer delay counter R2 = OUTER_COUNT
00000219: D207  ;     LD R2, [R0, #VARIABLES]
0000021A: D240  ;     LD R2, [R2, #VAR_OUTER_OFF]
0000021B:       ; 
0000021B:       ; LVL_OUTER_L_LOOP:
0000021B:       ; 
0000021B:       ;     ; Inner delay counter R1 = INNER_COUNT
0000021B: D107  ;     LD R1, [R0, #VARIABLES]
0000021C: D121  ;     LD R1, [R1, #VAR_INNER_OFF]
0000021D:       ; 
0000021D:       ; LVL_INNER_L_LOOP:
0000021D:       ; 
0000021D: 5921  ;     SUBS R1, R1, #1
0000021E: 5820  ;     CMP R1, #0
0000021F: F6FD  ;     BNE LVL_INNER_L_LOOP
00000220:       ; 
00000220: 5A41  ;     SUBS R2, R2, #1
00000221: 5840  ;     CMP R2, #0
00000222: F6F8  ;     BNE LVL_OUTER_L_LOOP
00000223:       ; 
00000223:       ;     ; Repeat the whole OUTER/INNER delay K times
00000223: 5DA1  ;     SUBS R5, R5, #1
00000224: F6F4  ;     BNE LVL_DELAY_K_LOOP
00000225:       ; 
00000225:       ;     ; Go show the next pixel (or finish if R6 == 0)
00000225: F0B0  ;     B DISPLAY_LEVEL_PATTERN
00000226:       ; 
00000226:       ; 
00000226:       ; 
00000226:       ; ; --- After all pixels for this level have been displayed/stored ---
00000226:       ; 
00000226:       ; FINISH_LEVEL_PATTERN:
00000226:       ; 
00000226:       ;     ; 1. Clear the sound
00000226: D402  ;     LD R4, [R0, #ADDRESS]
00000227: D483  ;     LD R4, [R4, #SOUND_ADDR_OFF]       ; R4 = SOUND_ADDR
00000228: D880  ;     ST R0, [R4]
00000229:       ; 
00000229:       ;     ; 2. Clear the matrix so the player starts from a blank screen
00000229:       ; 
00000229: D102  ;     LD R1, [R0, #ADDRESS]
0000022A: D121  ;     LD R1, [R1, #MAT_END_OFF]          ; MATRIX END ADDRESS
0000022B:       ; 
0000022B: D301  ;     LD R3, [R0, #COLOURS]
0000022C: D362  ;     LD R3, [R3, #BLACK_OFF]            ; BLACK colour
0000022D:       ; 
0000022D: D202  ;     LD R2, [R0, #ADDRESS]
0000022E: D240  ;     LD R2, [R2, #MAT_BASE_OFF]         ; MATRIX BASE ADDRESS
0000022F:       ; 
0000022F:       ; LOOP_CLEAR:
0000022F:       ; 
0000022F: DB40  ;     ST R3, [R2]
00000230: 1241  ;     ADD R2, R2, #1
00000231: 4844  ;     CMP R2, R1
00000232: F6FC  ;     BNE LOOP_CLEAR
00000233:       ; 
00000233: F000  ;     B LOAD                              ; Jump to start the game
00000234:       ; 
00000234:       ; 
00000234:       ; 
00000234:       ; LOAD:
00000234: D406  ;     LD R4, [R0, #POSITION];CURRENT POSITION
00000235: D480  ;     LD R4, [R4, #POS_CURRENT_OFF]
00000236:       ; 
00000236: D102  ;     LD R1, [R0, #ADDRESS]
00000237: D124  ;     LD R1, [R1, #KEY_ADDR_OFF];KEYPAD ADDR
00000238:       ; 
00000238: D501  ;     LD R5, [R0, #COLOURS]
00000239: D5A2  ;     LD R5, [R5, #BLACK_OFF];BLACK COLOUR
0000023A:       ; 
0000023A: D301  ;     LD R3, [R0, #COLOURS];WHITE COLOUR
0000023B: D360  ;     LD R3, [R3, #WHITE_OFF]
0000023C:       ; 
0000023C:       ; 
0000023C: F014  ;     B START_GAME
0000023D:       ; 
0000023D:       ; 
0000023D:       ; 
0000023D:       ; ; ==============================================================================
0000023D:       ; ; ASSESSING USER INPUT
0000023D:       ; ; ==============================================================================
0000023D:       ; 
0000023D:       ; 
0000023D:       ; 
0000023D:       ; ;wait for keypad to go back to zero, but still have the contents of it stored into r2. 
0000023D:       ; ;we can use r1 and r2, 
0000023D:       ; WAIT_FOR_KEYPAD_ZERO:
0000023D: D102  ;     LD R1, [R0, #ADDRESS]
0000023E: D124  ;     LD R1, [R1, #KEY_ADDR_OFF];KEYPAD ADDR
0000023F: D120  ;     LD R1, [R1]
00000240: 4820  ;     CMP R1, R0
00000241: F6FB  ;     BNE WAIT_FOR_KEYPAD_ZERO
00000242: F016  ;     B KEY_PAD_NOW_ZERO
00000243:       ; 
00000243:       ; 
00000243:       ; NEAR_UPDATE_CURRENT:
00000243: D606  ;     LD R6, [R0, #POSITION]
00000244: DCC0  ;     ST R4, [R6, #POS_CURRENT_OFF]
00000245: F000  ;     B DELAY3
00000246:       ; 
00000246:       ; 
00000246:       ; DELAY3:
00000246: D607  ;     LD R6, [R0, #VARIABLES];OUTER_COUNT
00000247: D6C0  ;     LD R6, [R6, #VAR_OUTER_OFF]
00000248:       ; OUTER_LOOP3:
00000248: D107  ;     LD R1, [R0, #VARIABLES]
00000249: D121  ;     LD R1, [R1, #VAR_INNER_OFF];INNER COUNT
0000024A:       ; INNER_LOOP3:
0000024A: 5921  ;     SUBS R1, R1, #1
0000024B: 5820  ;     CMP R1, #0
0000024C: F6FD  ;     BNE INNER_LOOP3
0000024D:       ; 
0000024D: 5EC1  ;     SUBS R6, R6, #1
0000024E: 58C0  ;     CMP R6, #0
0000024F: F6F8  ;     BNE OUTER_LOOP3
00000250:       ;     
00000250: F002  ;     B WAIT
00000251:       ; 
00000251:       ; 
00000251:       ; 
00000251:       ; START_GAME:
00000251:       ;     
00000251: DB80  ;     ST R3, [R4]
00000252: F000  ;     B WAIT
00000253:       ; 
00000253:       ; 
00000253:       ; 
00000253:       ; WAIT:
00000253: D102  ;     LD R1, [R0, #ADDRESS]
00000254: D124  ;     LD R1, [R1, #KEY_ADDR_OFF];KEYPAD ADDR
00000255: D220  ;     LD R2, [R1]
00000256:       ; 
00000256: 4840  ;     CMP R2, R0
00000257: F7FB  ;     BEQ WAIT
00000258:       ; 
00000258:       ;     ;this is the point in whcih there is an input
00000258: F0E4  ;     B WAIT_FOR_KEYPAD_ZERO
00000259:       ; KEY_PAD_NOW_ZERO:
00000259:       ; 
00000259: D604  ;     LD R6, [R0, #KEYPAD];DOWN
0000025A: D6C0  ;     LD R6, [R6, #KEY_DOWN_OFF]
0000025B:       ; 
0000025B: 4858  ;     CMP R2, R6
0000025C: F739  ;     BEQ DOWN
0000025D:       ; 
0000025D: D604  ;     LD R6, [R0, #KEYPAD];UP
0000025E: D6C1  ;     LD R6, [R6, #KEY_UP_OFF]
0000025F:       ; 
0000025F:       ;     
0000025F: 4858  ;     CMP R2, R6
00000260: F711  ;     BEQ UP
00000261:       ; 
00000261:       ; 
00000261: D604  ;     LD R6, [R0, #KEYPAD];LEFT
00000262: D6C2  ;     LD R6, [R6, #KEY_LEFT_OFF]
00000263:       ; 
00000263: 4858  ;     CMP R2, R6
00000264: F71F  ;     BEQ LEFT
00000265:       ; 
00000265: D604  ;     LD R6, [R0, #KEYPAD];RIGHT
00000266: D6C3  ;     LD R6, [R6, #KEY_RIGHT_OFF]
00000267: 4858  ;     CMP R2, R6
00000268: F73F  ;     BEQ RIGHT
00000269:       ; 
00000269:       ; 
00000269:       ;     ;5
00000269:       ;     ;STORE
00000269: D604  ;     LD R6, [R0, #KEYPAD];SELECTED
0000026A: D6C4  ;     LD R6, [R6, #KEY_SELECT_OFF]
0000026B: 4858  ;     CMP R2, R6
0000026C: F755  ;     BEQ STORE
0000026D:       ; 
0000026D:       ; 
0000026D:       ;     ;#
0000026D:       ;     ;so we need to firstly we need to store the level position in a table, so the initial display nee
                ; ds to be fixed 
0000026D:       ;     ; then we compare these tables
0000026D:       ; 
0000026D:       ;     ;first way would be to get a second memory table, then compare both tables
0000026D:       ;     ;second way would be to use the same memory table setting selected pixels to red, then when a use
                ; r sets it instead
0000026D:       ;     ;of going to 1, it will go to 0 right
0000026D:       ;     ;then at the end we loop through the whole table to see if its all 0
0000026D: D604  ;     LD R6, [R0, #KEYPAD]
0000026E: D6C5  ;     LD R6, [R6, #KEY_PASS_OFF]
0000026F: 4858  ;     CMP R2, R6
00000270: F76C  ;     BEQ PASSED
00000271:       ; 
00000271:       ; 
00000271: F0E1  ;     B WAIT
00000272:       ; 
00000272:       ; 
00000272:       ; ; ==============================================================================
00000272:       ; ; DRAW USER PIXEL/VERIFY
00000272:       ; ; ==============================================================================
00000272:       ; 
00000272:       ; 
00000272:       ; UP:
00000272:       ;     ;need to check if current block is seleted, if so skip setting it to black 
00000272:       ;     ;current is in r4
00000272:       ;     ;KNOW WHAT BRANCH WERE ON WITH R5
00000272: D207  ;     LD R2, [R0, #VARIABLES]
00000273: D247  ;     LD R2, [R2, #VAR_UP1_OFF]
00000274:       ; 
00000274:       ;     ;B CHECK
00000274: D109  ;     LD R1, [R0, #BRANCH]
00000275: D121  ;     LD R1, [R1, #BR_CHECK_OFF]
00000276: 0720  ;     ADD R7, R1, R0
00000277:       ;     
00000277:       ; UPBRANC1:
00000277: DD80  ;     ST R5, [R4]
00000278:       ; UPBRANC2:
00000278: 5488  ;     SUB R4, R4, #8
00000279: D607  ;     LD R6, [R0, #VARIABLES]
0000027A: D6C2  ;     LD R6, [R6, #VAR_LOWER_OFF];LOWER BOUND
0000027B:       ; 
0000027B: 4898  ;     CMP R4, R6
0000027C: FD3D  ;     BLT UP_CHECK
0000027D:       ;    
0000027D:       ; UP_BACK:
0000027D:       ;     ;check again if current block is selected, if so skip this store
0000027D: D207  ;     LD R2, [R0, #VARIABLES]
0000027E: D248  ;     LD R2, [R2, #VAR_UP2_OFF]
0000027F:       ; 
0000027F:       ; 
0000027F:       ;     ;B CHECK
0000027F: D109  ;     LD R1, [R0, #BRANCH]
00000280: D121  ;     LD R1, [R1, #BR_CHECK_OFF]
00000281: 0720  ;     ADD R7, R1, R0
00000282:       ; 
00000282:       ; UPBRANC3:
00000282: DB80  ;     ST R3, [R4]
00000283: F0BF  ;     B NEAR_UPDATE_CURRENT
00000284:       ; 
00000284:       ; 
00000284:       ; 
00000284:       ; LEFT:
00000284: D207  ;     LD R2, [R0, #VARIABLES]
00000285: D249  ;     LD R2, [R2, #VAR_LEFT1_OFF]
00000286:       ; 
00000286:       ; 
00000286:       ;     ;B CHECK
00000286: D109  ;     LD R1, [R0, #BRANCH]
00000287: D121  ;     LD R1, [R1, #BR_CHECK_OFF]
00000288: 0720  ;     ADD R7, R1, R0
00000289:       ; LEFTBRANC1:
00000289: DD80  ;     ST R5, [R4]
0000028A:       ; LEFTBRANC2:
0000028A: 5481  ;     SUB R4, R4, #1
0000028B: D607  ;     LD R6, [R0, #VARIABLES]
0000028C: D6C2  ;     LD R6, [R6, #VAR_LOWER_OFF];LOWER BOUND
0000028D:       ; 
0000028D: 4898  ;     CMP R4, R6
0000028E: FD2F  ;     BLT LEFT_CHECK
0000028F:       ; LEFT_BACK:
0000028F: D207  ;     LD R2, [R0, #VARIABLES]
00000290: D24A  ;     LD R2, [R2, #VAR_LEFT2_OFF]
00000291:       ; 
00000291:       ;     ;B CHECK
00000291: D109  ;     LD R1, [R0, #BRANCH]
00000292: D121  ;     LD R1, [R1, #BR_CHECK_OFF]
00000293: 0720  ;     ADD R7, R1, R0
00000294:       ; LEFTBRANC3:
00000294: DB80  ;     ST R3, [R4]
00000295:       ;     
00000295: F0AD  ;     B NEAR_UPDATE_CURRENT
00000296:       ; 
00000296:       ; 
00000296:       ; 
00000296:       ; 
00000296:       ; DOWN:
00000296: D207  ;     LD R2, [R0, #VARIABLES]
00000297: D24D  ;     LD R2, [R2, #VAR_DOWN1_OFF]
00000298:       ; 
00000298:       ;     ;B CHECK
00000298: D109  ;     LD R1, [R0, #BRANCH]
00000299: D121  ;     LD R1, [R1, #BR_CHECK_OFF]
0000029A: 0720  ;     ADD R7, R1, R0
0000029B:       ;    
0000029B:       ; DOWNBRANC1:
0000029B: DD80  ;     ST R5, [R4]
0000029C:       ; DOWNBRANC2:
0000029C: 1488  ;     ADD R4, R4, #8
0000029D: D607  ;     LD R6, [R0, #VARIABLES]
0000029E: D6C3  ;     LD R6, [R6, #VAR_UPPER_OFF];UPPER BOUND
0000029F:       ;     
0000029F: 4898  ;     CMP R4, R6
000002A0: FE1B  ;     BGT DOWN_CHECK
000002A1:       ; DOWN_BACK:
000002A1: D207  ;     LD R2, [R0, #VARIABLES]
000002A2: D24E  ;     LD R2, [R2, #VAR_DOWN2_OFF]
000002A3:       ; 
000002A3: D109  ;     LD R1, [R0, #BRANCH]
000002A4: D121  ;     LD R1, [R1, #BR_CHECK_OFF]
000002A5: 0720  ;     ADD R7, R1, R0
000002A6:       ; 
000002A6:       ; DOWNBRANC3:
000002A6: DB80  ;     ST R3, [R4]
000002A7: F09B  ;     B NEAR_UPDATE_CURRENT
000002A8:       ; 
000002A8:       ; 
000002A8:       ; RIGHT:
000002A8: D207  ;     LD R2, [R0, #VARIABLES]
000002A9: D24B  ;     LD R2, [R2, #VAR_RIGHT1_OFF]
000002AA:       ;     ;B CHECK
000002AA: D109  ;     LD R1, [R0, #BRANCH]
000002AB: D121  ;     LD R1, [R1, #BR_CHECK_OFF]
000002AC: 0720  ;     ADD R7, R1, R0
000002AD:       ; RIGHTBRANC1:
000002AD: DD80  ;     ST R5, [R4]
000002AE:       ; RIGHTBRANC2:
000002AE: 1481  ;     ADD R4, R4, #1
000002AF: D607  ;     LD R6, [R0, #VARIABLES]
000002B0: D6C3  ;     LD R6, [R6, #VAR_UPPER_OFF];UPPER BOUND
000002B1:       ; 
000002B1: 4898  ;     CMP R4, R6
000002B2: FE0D  ;     BGT RIGHT_CHECK
000002B3:       ; RIGHT_BACK:
000002B3: D207  ;     LD R2, [R0, #VARIABLES]
000002B4: D24C  ;     LD R2, [R2, #VAR_RIGHT2_OFF]
000002B5:       ; 
000002B5:       ; 
000002B5:       ;     ;B CHECK
000002B5: D109  ;     LD R1, [R0, #BRANCH]
000002B6: D121  ;     LD R1, [R1, #BR_CHECK_OFF]
000002B7: 0720  ;     ADD R7, R1, R0
000002B8:       ; RIGHTBRANC3:
000002B8: DB80  ;     ST R3, [R4]
000002B9: F089  ;     B NEAR_UPDATE_CURRENT
000002BA:       ; 
000002BA:       ; 
000002BA:       ; UP_CHECK:
000002BA: 1488  ;     ADD R4, R4, #8
000002BB: F0C1  ;     B UP_BACK
000002BC:       ; 
000002BC:       ; 
000002BC:       ; DOWN_CHECK:
000002BC: 5488  ;     SUB R4, R4, #8
000002BD: F0E3  ;     B DOWN_BACK
000002BE:       ; 
000002BE:       ; LEFT_CHECK:
000002BE: 1481  ;     ADD R4, R4, #1
000002BF: F0CF  ;     B LEFT_BACK
000002C0:       ; 
000002C0:       ; RIGHT_CHECK:
000002C0: 5481  ;     SUB R4, R4, #1
000002C1: F0F1  ;     B RIGHT_BACK
000002C2:       ; 
000002C2:       ; 
000002C2:       ; 
000002C2:       ; STORE:
000002C2: D106  ;     LD R1, [R0, #POSITION]
000002C3: D121  ;     LD R1, [R1, #POS_BOUND1_OFF];BOUND 1
000002C4: 4884  ;     CMP R4, R1
000002C5: FF25  ;     BLE LOAD_FIRST_POS_TABLE2
000002C6:       ; 
000002C6: D106  ;     LD R1, [R0, #POSITION]
000002C7: D122  ;     LD R1, [R1, #POS_BOUND2_OFF];BOUND 2
000002C8: 4884  ;     CMP R4, R1
000002C9: FF26  ;     BLE LOAD_SECOND_POS_TABLE2
000002CA:       ; 
000002CA: D106  ;     LD R1, [R0, #POSITION]
000002CB: D123  ;     LD R1, [R1, #POS_BOUND3_OFF];BOUND 3
000002CC: 4884  ;     CMP R4, R1
000002CD: FF27  ;     BLE LOAD_THIRD_POS_TABLE2
000002CE:       ; 
000002CE: F02B  ;     B LOAD_FOURTH_POS_TABLE2
000002CF:       ; 
000002CF:       ; 
000002CF:       ;     ;need to change here
000002CF:       ; AFTER_LOADING_POS_TABLE2:
000002CF: 4298  ;     SUB R2, R4, R6;OFFSET
000002D0: 0368  ;     ADD R3, R3, R2
000002D1: D160  ;     LD R1, [R3]
000002D2:       ; 
000002D2:       ; 
000002D2: 4820  ;     CMP R1, R0
000002D3: F72B  ;     BEQ ADD_DATA_IN
000002D4:       ; 
000002D4: F035  ;     B DELETE_DATA
000002D5:       ; 
000002D5:       ; 
000002D5:       ; 
000002D5:       ; 
000002D5:       ; ; ==============================================================================
000002D5:       ; ; VERIFY
000002D5:       ; ; ==============================================================================
000002D5:       ; 
000002D5:       ; 
000002D5:       ; 
000002D5:       ; 
000002D5:       ; 
000002D5:       ; ; ==============================================================================
000002D5:       ; ; CHECK FOR WIN
000002D5:       ; ; ==============================================================================
000002D5:       ; 
000002D5:       ; 
000002D5:       ; PASS:
000002D5: D607  ;     LD R6, [R0, #VARIABLES]
000002D6: D6CF  ;     LD R6, [R6, #VAR_LEVEL_CNT_OFF]
000002D7: 16C1  ;     ADD R6, R6, #1
000002D8:       ; 
000002D8: D407  ;     LD R4, [R0, #VARIABLES]
000002D9: DE8F  ;     ST R6, [R4, #VAR_LEVEL_CNT_OFF]
000002DA:       ; 
000002DA: D108  ;     LD R1, [R0, #JUMPTABLE]
000002DB: D121  ;     LD R1, [R1, #JUMP_RST_OFF];wait
000002DC: 0720  ;     ADD R7, R1, R0
000002DD:       ;     
000002DD:       ; ;OUTER LOOP needs to point to the next variable
000002DD:       ; ;r6r2
000002DD:       ; ;inner loop needs to take e.g. pos 0 and add 1 to it 16 times
000002DD:       ; ;r1, r5
000002DD:       ; 
000002DD:       ; PASSED:
000002DD:       ;     
000002DD: D106  ;     LD R1, [R0,#POSITION]
000002DE: D224  ;     LD R2, [R1,#SEL_POS_TABLE]
000002DF: D32C  ;     LD R3, [R1,#LEV_POS_TABLE]
000002E0:       ; 
000002E0: D103  ;     LD R1, [R0,#SOUND]
000002E1: D125  ;     LD r1, [r1,#VALUE_64_OFFSET] ;r1 = 64
000002E2:       ; 
000002E2:       ; CHECK_LOOP:
000002E2: D440  ;     LD R4, [R2] ;r4 = sel[i] 
000002E3: D560  ;     LD R5, [R3] ;R5 = lev[i]
000002E4: 4894  ;     CMP R4, R5
000002E5: F62B  ;     BNE FAIL 
000002E6: 1241  ;     ADD R2, R2, #1
000002E7: 1361  ;     ADD R3, R3, #1 
000002E8: 5921  ;     SUBS R1, R1, #1
000002E9: F7EB  ;     BEQ PASS  
000002EA: F0F7  ;     BAL CHECK_LOOP
000002EB:       ; 
000002EB:       ; 
000002EB:       ; LOAD_FIRST_POS_TABLE2:
000002EB: D306  ;     LD R3, [R0, #POSITION]
000002EC: D364  ;     LD R3, [R3, #POS_PTR1_OFF];POINTER
000002ED:       ; 
000002ED: D606  ;     LD R6, [R0, #POSITION];LOWER_BOUND1
000002EE: D6C8  ;     LD R6, [R6, #POS_LOWER1_OFF]
000002EF:       ; 
000002EF: F0DF  ;     B AFTER_LOADING_POS_TABLE2
000002F0:       ; 
000002F0:       ; 
000002F0:       ; 
000002F0:       ; LOAD_SECOND_POS_TABLE2:
000002F0: D306  ;     LD R3, [R0, #POSITION]
000002F1: D365  ;     LD R3, [R3, #POS_PTR2_OFF];POINTER TO POS16
000002F2:       ; 
000002F2: D606  ;     LD R6, [R0, #POSITION];LOWER_BOUND2
000002F3: D6C9  ;     LD R6, [R6, #POS_LOWER2_OFF]
000002F4:       ; 
000002F4: F0DA  ;     B AFTER_LOADING_POS_TABLE2
000002F5:       ; 
000002F5:       ; 
000002F5:       ; LOAD_THIRD_POS_TABLE2:
000002F5: D306  ;     LD R3, [R0, #POSITION]
000002F6: D366  ;     LD R3, [R3, #POS_PTR3_OFF];POINTER TO POS32
000002F7:       ; 
000002F7: D606  ;     LD R6, [R0, #POSITION];LOWER_BOUND3
000002F8: D6CA  ;     LD R6, [R6, #POS_LOWER3_OFF]
000002F9: F0D5  ;     B AFTER_LOADING_POS_TABLE2
000002FA:       ; 
000002FA:       ; 
000002FA:       ; LOAD_FOURTH_POS_TABLE2:
000002FA: D306  ;     LD R3, [R0, #POSITION]
000002FB: D367  ;     LD R3, [R3, #POS_PTR4_OFF];POINTER TO POS48
000002FC:       ; 
000002FC: D606  ;     LD R6, [R0, #POSITION];LOWER_BOUND4
000002FD: D6CB  ;     LD R6, [R6, #POS_LOWER4_OFF]
000002FE:       ; 
000002FE: F0D0  ;     B AFTER_LOADING_POS_TABLE2
000002FF:       ; 
000002FF:       ; 
000002FF:       ; 
000002FF:       ; 
000002FF:       ; ADD_DATA_IN:
000002FF: D207  ;     LD R2, [R0, #VARIABLES]
00000300: D245  ;     LD R2, [R2, #VAR_ONE_OFF];ONE
00000301: DA60  ;     ST R2, [R3]
00000302: D301  ;     LD R3, [R0, #COLOURS];Because we changed white we have to change it back
00000303: D360  ;     LD R3, [R3, #WHITE_OFF]
00000304: D101  ;     LD R1, [R0, #COLOURS]
00000305: D121  ;     LD R1, [R1, #RED_OFF];RED
00000306: D980  ;     ST R1, [R4]
00000307:       ; 
00000307:       ; 
00000307:       ;     
00000307: D109  ;     LD R1, [R0, #BRANCH]
00000308: D120  ;     LD R1, [R1, #BR_WAIT_OFF];wait
00000309: 0720  ;     ADD R7, R1, R0
0000030A:       ; 
0000030A:       ; DELETE_DATA:
0000030A: D860  ;     ST R0, [R3]
0000030B: D101  ;     LD R1, [R0, #COLOURS]
0000030C: D120  ;     LD R1, [R1, #WHITE_OFF];WHITE
0000030D: D980  ;     ST R1, [R4]
0000030E:       ; 
0000030E:       ; 
0000030E:       ; 
0000030E: D109  ;     LD R1, [R0, #BRANCH]
0000030F: D120  ;     LD R1, [R1, #BR_WAIT_OFF];wait
00000310: 0720  ;     ADD R7, R1, R0
00000311:       ; 
00000311:       ; 
00000311:       ; 
00000311:       ;     ;TAKE CURRENT POS CHECK IF ALREADY IN ARRAY
00000311:       ;     ;IF ITS ALREADY IN ARRAY WE NEED TO REMOVE IT
00000311:       ;     ;IF NOT THEN ADD IT TO ARRAY
00000311:       ; 
00000311:       ; 
00000311:       ;     ;DELETE ALL 
00000311:       ;     ;CHECK FUNCTION CHECKS IF ITS 0 OR SOMETHING IS IN THERE
00000311:       ; 
00000311:       ; 
00000311:       ; 
00000311:       ; ; ==============================================================================
00000311:       ; ; OTHERWISE FAIL
00000311:       ; ; ==============================================================================
00000311:       ; 
00000311:       ; FAIL:
00000311:       ;     ; -------------------------------------------------
00000311:       ;     ; Initial paint of mistakes (extras red, missed green)
00000311:       ;     ; -------------------------------------------------
00000311:       ; 
00000311:       ;     ; R2 = &SELECTED_POSITIONS_TABLE[0]
00000311:       ;     ; R3 = &LEVEL_POSITIONS_TABLE[0]
00000311: D606  ;     LD  R6, [R0, #POSITION]
00000312: D2C4  ;     LD  R2, [R6, #SEL_POS_TABLE]
00000313: D3CC  ;     LD  R3, [R6, #LEV_POS_TABLE]
00000314:       ; 
00000314:       ;     ; R4 = MATRIX_BASE_ADDR (0xFF00)
00000314: D602  ;     LD  R6, [R0, #ADDRESS]
00000315: D4C0  ;     LD  R4, [R6, #MAT_BASE_OFF]
00000316:       ; 
00000316:       ;     ; R1 = 64 entries
00000316: D103  ;     LD  R1, [R0, #SOUND]
00000317: D125  ;     LD  R1, [R1, #VALUE_64_OFFSET]
00000318:       ; 
00000318:       ; FAIL_INIT_LOOP:
00000318: D540  ;     LD  R5, [R2]          ; R5 = SEL[i]
00000319: D660  ;     LD  R6, [R3]          ; R6 = LEV[i]
0000031A:       ; 
0000031A: 48B8  ;     CMP R5, R6
0000031B: F709  ;     BEQ FAIL_INIT_NEXT    ; equal -> correct (stay as-is: red if user got it)
0000031C:       ; 
0000031C:       ;     ; mismatch
0000031C: 48A0  ;     CMP R5, R0
0000031D: F704  ;     BEQ FAIL_INIT_MISSED  ; SEL=0, LEV=1 -> missed pixel (GREEN)
0000031E:       ; 
0000031E:       ;     ; SEL=1, LEV=0 -> extra selection (RED)
0000031E: D601  ;     LD  R6, [R0, #COLOURS]
0000031F: D6C1  ;     LD  R6, [R6, #RED_OFF]
00000320: DE80  ;     ST  R6, [R4]
00000321: F003  ;     B   FAIL_INIT_NEXT
00000322:       ; 
00000322:       ; FAIL_INIT_MISSED:
00000322: D601  ;     LD  R6, [R0, #COLOURS]
00000323: D6C3  ;     LD  R6, [R6, #GREEN_OFF]
00000324: DE80  ;     ST  R6, [R4]
00000325:       ; 
00000325:       ; FAIL_INIT_NEXT:
00000325: 1241  ;     ADD R2, R2, #1
00000326: 1361  ;     ADD R3, R3, #1
00000327: 1481  ;     ADD R4, R4, #1
00000328: 5921  ;     SUBS R1, R1, #1
00000329: F6EE  ;     BNE FAIL_INIT_LOOP
0000032A:       ; 
0000032A:       ;     ; -------------------------------------------------
0000032A:       ;     ; Turn on 'L' on the SW-LEDs (as before)
0000032A:       ;     ; -------------------------------------------------
0000032A: D102  ;     LD  R1, [R0, #ADDRESS]
0000032B: D127  ;     LD  R1, [R1, #SW_LED_ADDR_OFF]     ; R1 = &SW LEDs (0xFF97)
0000032C:       ; 
0000032C: D203  ;     LD  R2, [R0, #SOUND]
0000032D: D246  ;     LD  R2, [R2, #LED_L_PAT_OFF]       ; 0x006A pattern
0000032E: DA20  ;     ST  R2, [R1]                       ; turn on 'L'
0000032F:       ; 
0000032F:       ;     ; -------------------------------------------------
0000032F:       ;     ; Main FAIL loop: flash extra selections in red
0000032F:       ;     ; -------------------------------------------------
0000032F:       ; FAIL_LOOP:
0000032F:       ; 
0000032F:       ;     ; ===== Phase A: extras RED, missed GREEN =====
0000032F: D606  ;     LD  R6, [R0, #POSITION]
00000330: D2C4  ;     LD  R2, [R6, #SEL_POS_TABLE]
00000331: D3CC  ;     LD  R3, [R6, #LEV_POS_TABLE]
00000332:       ; 
00000332: D602  ;     LD  R6, [R0, #ADDRESS]
00000333: D4C0  ;     LD  R4, [R6, #MAT_BASE_OFF]
00000334:       ; 
00000334: D103  ;     LD  R1, [R0, #SOUND]
00000335: D125  ;     LD  R1, [R1, #VALUE_64_OFFSET]     ; 64 pixels
00000336:       ; 
00000336:       ; FAIL_RED_LOOP:
00000336: D540  ;     LD  R5, [R2]          ; SEL[i]
00000337: D660  ;     LD  R6, [R3]          ; LEV[i]
00000338:       ; 
00000338: 48B8  ;     CMP R5, R6
00000339: F709  ;     BEQ FAIL_RED_NEXT     ; correct -> leave as-is (solid red or black)
0000033A:       ; 
0000033A: 48A0  ;     CMP R5, R0
0000033B: F704  ;     BEQ FAIL_RED_MISSED   ; SEL=0,LEV=1 -> missed => GREEN
0000033C:       ; 
0000033C:       ;     ; SEL=1, LEV=0 -> extra => RED
0000033C: D601  ;     LD  R6, [R0, #COLOURS]
0000033D: D6C1  ;     LD  R6, [R6, #RED_OFF]
0000033E: DE80  ;     ST  R6, [R4]
0000033F: F003  ;     B   FAIL_RED_NEXT
00000340:       ; 
00000340:       ; FAIL_RED_MISSED:
00000340: D601  ;     LD  R6, [R0, #COLOURS]
00000341: D6C3  ;     LD  R6, [R6, #GREEN_OFF]
00000342: DE80  ;     ST  R6, [R4]
00000343:       ; 
00000343:       ; FAIL_RED_NEXT:
00000343: 1241  ;     ADD R2, R2, #1
00000344: 1361  ;     ADD R3, R3, #1
00000345: 1481  ;     ADD R4, R4, #1
00000346: 5921  ;     SUBS R1, R1, #1
00000347: F6EE  ;     BNE FAIL_RED_LOOP
00000348:       ; 
00000348:       ;     ; short delay
00000348:       ; FAIL_RED_DELAY_OUTER:
00000348: D607  ;     LD  R6, [R0, #VARIABLES]
00000349: D6C0  ;     LD  R6, [R6, #VAR_OUTER_OFF]
0000034A:       ; FAIL_RED_DELAY_O:
0000034A: D107  ;     LD  R1, [R0, #VARIABLES]
0000034B: D121  ;     LD  R1, [R1, #VAR_INNER_OFF]
0000034C:       ; FAIL_RED_DELAY_I:
0000034C: 5921  ;     SUBS R1, R1, #1
0000034D: F6FE  ;     BNE  FAIL_RED_DELAY_I
0000034E: 5EC1  ;     SUBS R6, R6, #1
0000034F: F6FA  ;     BNE  FAIL_RED_DELAY_O
00000350:       ; 
00000350:       ;     ; ===== Phase B: extras BLACK, missed still GREEN =====
00000350: D606  ;     LD  R6, [R0, #POSITION]
00000351: D2C4  ;     LD  R2, [R6, #SEL_POS_TABLE]
00000352: D3CC  ;     LD  R3, [R6, #LEV_POS_TABLE]
00000353:       ; 
00000353: D602  ;     LD  R6, [R0, #ADDRESS]
00000354: D4C0  ;     LD  R4, [R6, #MAT_BASE_OFF]
00000355:       ; 
00000355: D103  ;     LD  R1, [R0, #SOUND]
00000356: D125  ;     LD  R1, [R1, #VALUE_64_OFFSET]
00000357:       ; 
00000357:       ; FAIL_BLK_LOOP:
00000357: D540  ;     LD  R5, [R2]          ; SEL[i]
00000358: D660  ;     LD  R6, [R3]          ; LEV[i]
00000359:       ; 
00000359: 48B8  ;     CMP R5, R6
0000035A: F709  ;     BEQ FAIL_BLK_NEXT     ; correct -> leave as-is
0000035B:       ; 
0000035B: 48A0  ;     CMP R5, R0
0000035C: F704  ;     BEQ FAIL_BLK_MISSED   ; SEL=0,LEV=1 -> GREEN
0000035D:       ; 
0000035D:       ;     ; SEL=1, LEV=0 -> extra => BLACK
0000035D: D601  ;     LD  R6, [R0, #COLOURS]
0000035E: D6C2  ;     LD  R6, [R6, #BLACK_OFF]
0000035F: DE80  ;     ST  R6, [R4]
00000360: F003  ;     B   FAIL_BLK_NEXT
00000361:       ; 
00000361:       ; FAIL_BLK_MISSED:
00000361: D601  ;     LD  R6, [R0, #COLOURS]
00000362: D6C3  ;     LD  R6, [R6, #GREEN_OFF]
00000363: DE80  ;     ST  R6, [R4]
00000364:       ; 
00000364:       ; FAIL_BLK_NEXT:
00000364: 1241  ;     ADD R2, R2, #1
00000365: 1361  ;     ADD R3, R3, #1
00000366: 1481  ;     ADD R4, R4, #1
00000367: 5921  ;     SUBS R1, R1, #1
00000368: F6EE  ;     BNE FAIL_BLK_LOOP
00000369:       ; 
00000369:       ;     ; short delay
00000369:       ; FAIL_BLK_DELAY_OUTER:
00000369: D607  ;     LD  R6, [R0, #VARIABLES]
0000036A: D6C0  ;     LD  R6, [R6, #VAR_OUTER_OFF]
0000036B:       ; FAIL_BLK_DELAY_O:
0000036B: D107  ;     LD  R1, [R0, #VARIABLES]
0000036C: D121  ;     LD  R1, [R1, #VAR_INNER_OFF]
0000036D:       ; FAIL_BLK_DELAY_I:
0000036D: 5921  ;     SUBS R1, R1, #1
0000036E: F6FE  ;     BNE  FAIL_BLK_DELAY_I
0000036F: 5EC1  ;     SUBS R6, R6, #1
00000370: F6FA  ;     BNE  FAIL_BLK_DELAY_O
00000371:       ; 
00000371:       ;     ; ===== After one full RED+BLACK flash cycle, check SW-D =====
00000371: D102  ;     LD  R1, [R0, #ADDRESS]
00000372: D126  ;     LD  R1, [R1, #SW_SWITCH_ADDR_OFF]  ; R1 = &switches (0xFF95)
00000373: D220  ;     LD  R2, [R1]                       ; read switches A..H
00000374:       ; 
00000374: 1308  ;     ADD R3, R0, #8                     ; mask = 0x0008 (bit 3 -> SW-D)
00000375: 824C  ;     AND R2, R2, R3
00000376: 4840  ;     CMP R2, R0
00000377: F7B7  ;     BEQ FAIL_LOOP                      ; SW-D not pressed -> keep flashing
00000378:       ; 
00000378:       ;     ; -------------------------------------------------
00000378:       ;     ; SW-D pressed -> full hard reset (same as before)
00000378:       ;     ; -------------------------------------------------
00000378:       ; FAIL_HARD_RESET:
00000378:       ;     ; 1) LEVEL_COUNTER := 1
00000378: D407  ;     LD  R4, [R0, #VARIABLES]
00000379: D585  ;     LD  R5, [R4, #VAR_ONE_OFF]
0000037A: DD8F  ;     ST  R5, [R4, #VAR_LEVEL_CNT_OFF]
0000037B:       ; 
0000037B:       ;     ; 2) Clear SEL_POS_TABLE and LEV_POS_TABLE (64 entries)
0000037B: D106  ;     LD  R1, [R0, #POSITION]
0000037C: D224  ;     LD  R2, [R1, #SEL_POS_TABLE]       ; R2 = &SELECTED_POSITIONS_TABLE[0]
0000037D: D32C  ;     LD  R3, [R1, #LEV_POS_TABLE]       ; R3 = &LEVEL_POSITIONS_TABLE[0]
0000037E:       ; 
0000037E: D103  ;     LD  R1, [R0, #SOUND]
0000037F: D125  ;     LD  R1, [R1, #VALUE_64_OFFSET]     ; R1 = 64 (loop count)
00000380:       ; 
00000380:       ; FAIL_ZERO_LOOP:
00000380: D840  ;     ST  R0, [R2]
00000381: D860  ;     ST  R0, [R3]
00000382: 1241  ;     ADD R2, R2, #1
00000383: 1361  ;     ADD R3, R3, #1
00000384: 5921  ;     SUBS R1, R1, #1
00000385: F6FA  ;     BNE FAIL_ZERO_LOOP
00000386:       ; 
00000386:       ;     ; turn off LEDs when restarting
00000386: D602  ;     LD  R6, [R0, #ADDRESS]
00000387: D6C7  ;     LD  R6, [R6, #SW_LED_ADDR_OFF]
00000388: D8C0  ;     ST  R0, [R6]
00000389:       ; 
00000389:       ;     ; 3) Long jump to RESET using jump table
00000389: D108  ;     LD  R1, [R0, #JUMPTABLE]
0000038A: D121  ;     LD  R1, [R1, #JUMP_RST_OFF]        ; address of RESET
0000038B: 0720  ;     ADD R7, R1, R0                     ; PC := RESET
0000038C:       ; 
0000038C:       ; 
0000038C:       ; 
0000038C:       ; 
0000038C:       ; 
0000038C:       ; 
0000038C:       ; 
0000038C:       ; CHECK:
0000038C:       ; 
0000038C: D106  ;     LD R1, [R0, #POSITION]
0000038D: D121  ;     LD R1, [R1, #POS_BOUND1_OFF];BOUND 1
0000038E: 4884  ;     CMP R4, R1
0000038F: FF53  ;     BLE LOAD_FIRST_POS_TABLE
00000390:       ; 
00000390: D106  ;     LD R1, [R0, #POSITION]
00000391: D122  ;     LD R1, [R1, #POS_BOUND2_OFF];BOUND 2
00000392: 4884  ;     CMP R4, R1
00000393: FF54  ;     BLE LOAD_SECOND_POS_TABLE
00000394:       ; 
00000394: D106  ;     LD R1, [R0, #POSITION]
00000395: D123  ;     LD R1, [R1, #POS_BOUND3_OFF];BOUND 3
00000396: 4884  ;     CMP R4, R1
00000397: FF55  ;     BLE LOAD_THIRD_POS_TABLE
00000398:       ; 
00000398: F059  ;     B LOAD_FOURTH_POS_TABLE
00000399:       ; 
00000399:       ; 
00000399:       ; 
00000399:       ; AFTER_LOADING_POS_TABLE:
00000399: 4598  ;     SUB R5, R4, R6;OFFSET
0000039A: 0374  ;     ADD R3, R3, R5
0000039B: D160  ;     LD R1, [R3]
0000039C:       ; 
0000039C: D301  ;     LD R3, [R0, #COLOURS];Because we changed white we have to change it back
0000039D: D360  ;     LD R3, [R3, #WHITE_OFF]
0000039E:       ; 
0000039E: D501  ;     LD R5, [R0, #COLOURS]
0000039F: D5A2  ;     LD R5, [R5, #BLACK_OFF]
000003A0:       ; 
000003A0: 4820  ;     CMP R1, R0
000003A1:       ; 
000003A1: F701  ;     BEQ SET_REGISTER_0
000003A2:       ; 
000003A2: F620  ;     BNE SET_REGISTER_1
000003A3:       ;     ;SET SOME REGISTER TO SHOW THAT THE VALUE IS EMPTY
000003A3:       ; 
000003A3:       ; 
000003A3:       ; SET_REGISTER_0:
000003A3:       ; 
000003A3: D107  ;     LD R1, [R0, #VARIABLES]
000003A4: D127  ;     LD R1, [R1, #VAR_UP1_OFF];UPBRANCH 1
000003A5:       ; 
000003A5: 4828  ;     CMP R1, R2
000003A6: F750  ;     BEQ UPBRANC1TRAMPOLINE
000003A7:       ; 
000003A7:       ; 
000003A7: D107  ;     LD R1, [R0, #VARIABLES]
000003A8: D128  ;     LD R1, [R1, #VAR_UP2_OFF];UPBRANCH 3 (originally used offset 8 in code, which points to UPBRANCH2
                ; , but check logic for reuse)
000003A9:       ; 
000003A9: 4828  ;     CMP R1, R2
000003AA: F752  ;     BEQ UPBRANC3TRAMPOLINE
000003AB:       ; 
000003AB:       ; 
000003AB: D107  ;     LD R1, [R0, #VARIABLES]
000003AC: D129  ;     LD R1, [R1, #VAR_LEFT1_OFF];LEFTBRANCH1
000003AD:       ; 
000003AD: 4828  ;     CMP R1, R2
000003AE: F751  ;     BEQ LEFTBRANC1TRAMPOLINE
000003AF:       ;    
000003AF:       ; 
000003AF: D107  ;     LD R1, [R0, #VARIABLES]
000003B0: D12A  ;     LD R1, [R1, #VAR_LEFT2_OFF];LEFTBRANCH 3 (originally offset 10, points to LEFTBRANCH2)
000003B1:       ; 
000003B1: 4828  ;     CMP R1, R2
000003B2: F753  ;     BEQ LEFTBRANC3TRAMPOLINE
000003B3:       ; 
000003B3:       ; 
000003B3: D107  ;     LD R1, [R0, #VARIABLES]
000003B4: D12B  ;     LD R1, [R1, #VAR_RIGHT1_OFF];RIGHTBRANCH 1
000003B5:       ; 
000003B5: 4828  ;     CMP R1, R2
000003B6: F752  ;     BEQ RIGHTBRANC1TRAMPOLINE
000003B7:       ; 
000003B7:       ; 
000003B7: D107  ;     LD R1, [R0, #VARIABLES]
000003B8: D12C  ;     LD R1, [R1, #VAR_RIGHT2_OFF];RIGHTBRANCH 2
000003B9:       ; 
000003B9: 4828  ;     CMP R1, R2
000003BA: F754  ;     BEQ RIGHTBRANC3TRAMPOLINE
000003BB:       ; 
000003BB:       ; 
000003BB: D107  ;     LD R1, [R0, #VARIABLES]
000003BC: D12D  ;     LD R1, [R1, #VAR_DOWN1_OFF];DOWNBRANCH1
000003BD:       ; 
000003BD: 4828  ;     CMP R1, R2
000003BE: F753  ;     BEQ DOWNBRANC1TRAMPOLINE
000003BF:       ;    
000003BF:       ; 
000003BF: D107  ;     LD R1, [R0, #VARIABLES]
000003C0: D12E  ;     LD R1, [R1, #VAR_DOWN2_OFF];DOWNBRANCH 3
000003C1:       ; 
000003C1: 4828  ;     CMP R1, R2
000003C2: F755  ;     BEQ DOWNBRANC3TRAMPOLINE
000003C3:       ; 
000003C3:       ; 
000003C3:       ; 
000003C3:       ; SET_REGISTER_1:
000003C3:       ; 
000003C3: D107  ;     LD R1, [R0, #VARIABLES]
000003C4: D127  ;     LD R1, [R1, #VAR_UP1_OFF];UPBRANCH 2 (Note: original code checked offset #7 here, which is UPBRAN
                ; CH1, likely meant for trampling check)
000003C5:       ; 
000003C5: 4828  ;     CMP R1, R2
000003C6: F733  ;     BEQ UPBRANC2TRAMPOLINE
000003C7:       ; 
000003C7: D107  ;     LD R1, [R0, #VARIABLES]
000003C8: D128  ;     LD R1, [R1, #VAR_UP2_OFF]
000003C9:       ; 
000003C9: 4828  ;     CMP R1, R2
000003CA:       ; 
000003CA: F750  ;     BEQ TRAMPOLINE;near current update
000003CB:       ; 
000003CB:       ; 
000003CB: D107  ;     LD R1, [R0, #VARIABLES]
000003CC: D129  ;     LD R1, [R1, #VAR_LEFT1_OFF];LEFTBRANCH2
000003CD:       ; 
000003CD: 4828  ;     CMP R1, R2
000003CE: F734  ;     BEQ LEFTBRANC2TRAMPOLINE
000003CF:       ;    
000003CF:       ; 
000003CF: D107  ;     LD R1, [R0, #VARIABLES]
000003D0: D12A  ;     LD R1, [R1, #VAR_LEFT2_OFF];near current update
000003D1:       ; 
000003D1: 4828  ;     CMP R1, R2
000003D2: F748  ;     BEQ TRAMPOLINE
000003D3:       ; 
000003D3:       ; 
000003D3: D107  ;     LD R1, [R0, #VARIABLES]
000003D4: D12B  ;     LD R1, [R1, #VAR_RIGHT1_OFF];RIGHTBRANCH 2
000003D5:       ; 
000003D5: 4828  ;     CMP R1, R2
000003D6: F735  ;     BEQ RIGHTBRANC2TRAMPOLINE
000003D7:       ; 
000003D7:       ; 
000003D7: D107  ;     LD R1, [R0, #VARIABLES]
000003D8: D12C  ;     LD R1, [R1, #VAR_RIGHT2_OFF];near
000003D9:       ; 
000003D9: 4828  ;     CMP R1, R2
000003DA: F740  ;     BEQ TRAMPOLINE
000003DB:       ; 
000003DB:       ; 
000003DB: D107  ;     LD R1, [R0, #VARIABLES]
000003DC: D12D  ;     LD R1, [R1, #VAR_DOWN1_OFF];DOWNBRANCH2
000003DD:       ; 
000003DD: 4828  ;     CMP R1, R2
000003DE: F736  ;     BEQ DOWNBRANC2TRAMPOLINE
000003DF:       ;    
000003DF:       ; 
000003DF: D107  ;     LD R1, [R0, #VARIABLES]
000003E0: D12E  ;     LD R1, [R1, #VAR_DOWN2_OFF];nearcurrent
000003E1:       ; 
000003E1: 4828  ;     CMP R1, R2
000003E2:       ; 
000003E2:       ;     
000003E2: F738  ;     BEQ TRAMPOLINE
000003E3:       ;    
000003E3:       ; 
000003E3:       ; LOAD_FIRST_POS_TABLE:
000003E3: D306  ;     LD R3, [R0, #POSITION]
000003E4: D364  ;     LD R3, [R3, #POS_PTR1_OFF];POINTER
000003E5:       ; 
000003E5: D606  ;     LD R6, [R0, #POSITION];LOWER_BOUND1
000003E6: D6C8  ;     LD R6, [R6, #POS_LOWER1_OFF]
000003E7:       ; 
000003E7: F0B1  ;     B AFTER_LOADING_POS_TABLE
000003E8:       ; 
000003E8:       ; 
000003E8:       ; LOAD_SECOND_POS_TABLE:
000003E8: D306  ;     LD R3, [R0, #POSITION]
000003E9: D365  ;     LD R3, [R3, #POS_PTR2_OFF];POINTER TO POS16
000003EA:       ; 
000003EA: D606  ;     LD R6, [R0, #POSITION];LOWER_BOUND2
000003EB: D6C9  ;     LD R6, [R6, #POS_LOWER2_OFF]
000003EC:       ; 
000003EC: F0AC  ;     B AFTER_LOADING_POS_TABLE
000003ED:       ; 
000003ED:       ; 
000003ED:       ; LOAD_THIRD_POS_TABLE:
000003ED: D306  ;     LD R3, [R0, #POSITION]
000003EE: D366  ;     LD R3, [R3, #POS_PTR3_OFF];POINTER TO POS32
000003EF:       ; 
000003EF: D606  ;     LD R6, [R0, #POSITION];LOWER_BOUND3
000003F0: D6CA  ;     LD R6, [R6, #POS_LOWER3_OFF]
000003F1: F0A7  ;     B AFTER_LOADING_POS_TABLE
000003F2:       ; 
000003F2:       ; 
000003F2:       ; LOAD_FOURTH_POS_TABLE:
000003F2: D306  ;     LD R3, [R0, #POSITION]
000003F3: D367  ;     LD R3, [R3, #POS_PTR4_OFF];POINTER TO POS48
000003F4:       ; 
000003F4: D606  ;     LD R6, [R0, #POSITION];LOWER_BOUND4
000003F5: D6CB  ;     LD R6, [R6, #POS_LOWER4_OFF]
000003F6:       ; 
000003F6: F0A2  ;     B AFTER_LOADING_POS_TABLE
000003F7:       ; 
000003F7:       ; 
000003F7:       ; 
000003F7:       ; UPBRANC1TRAMPOLINE:
000003F7: D209  ;     LD R2, [R0, #BRANCH]
000003F8: D242  ;     LD R2, [R2, #BR_UP1_OFF]
000003F9: 0740  ;     ADD R7, R2, R0
000003FA:       ; UPBRANC2TRAMPOLINE:
000003FA: D209  ;     LD R2, [R0, #BRANCH]
000003FB: D243  ;     LD R2, [R2, #BR_UP2_OFF]
000003FC: 0740  ;     ADD R7, R2, R0
000003FD:       ; UPBRANC3TRAMPOLINE:
000003FD: D209  ;     LD R2, [R0, #BRANCH]
000003FE: D244  ;     LD R2, [R2, #BR_UP3_OFF]
000003FF: 0740  ;     ADD R7, R2, R0
00000400:       ; LEFTBRANC1TRAMPOLINE:
00000400: D209  ;     LD R2, [R0, #BRANCH]
00000401: D245  ;     LD R2, [R2, #BR_LEFT1_OFF]
00000402: 0740  ;     ADD R7, R2, R0
00000403:       ; LEFTBRANC2TRAMPOLINE:
00000403: D209  ;     LD R2, [R0, #BRANCH]
00000404: D246  ;     LD R2, [R2, #BR_LEFT2_OFF]
00000405: 0740  ;     ADD R7, R2, R0
00000406:       ; LEFTBRANC3TRAMPOLINE:
00000406: D209  ;     LD R2, [R0, #BRANCH]
00000407: D247  ;     LD R2, [R2, #BR_LEFT3_OFF]
00000408: 0740  ;     ADD R7, R2, R0
00000409:       ; RIGHTBRANC1TRAMPOLINE:
00000409: D209  ;     LD R2, [R0, #BRANCH]
0000040A: D248  ;     LD R2, [R2, #BR_RIGHT1_OFF]
0000040B: 0740  ;     ADD R7, R2, R0
0000040C:       ; RIGHTBRANC2TRAMPOLINE:
0000040C: D209  ;     LD R2, [R0, #BRANCH]
0000040D: D249  ;     LD R2, [R2, #BR_RIGHT2_OFF]
0000040E: 0740  ;     ADD R7, R2, R0
0000040F:       ; RIGHTBRANC3TRAMPOLINE:
0000040F: D209  ;     LD R2, [R0, #BRANCH]
00000410: D24A  ;     LD R2, [R2, #BR_RIGHT3_OFF]
00000411: 0740  ;     ADD R7, R2, R0
00000412:       ; DOWNBRANC1TRAMPOLINE:
00000412: D209  ;     LD R2, [R0, #BRANCH]
00000413: D24B  ;     LD R2, [R2, #BR_DOWN1_OFF]
00000414: 0740  ;     ADD R7, R2, R0
00000415:       ; DOWNBRANC2TRAMPOLINE:
00000415: D209  ;     LD R2, [R0, #BRANCH]
00000416: D24C  ;     LD R2, [R2, #BR_DOWN2_OFF]
00000417: 0740  ;     ADD R7, R2, R0
00000418:       ; DOWNBRANC3TRAMPOLINE:
00000418: D209  ;     LD R2, [R0, #BRANCH]
00000419: D24D  ;     LD R2, [R2, #BR_DOWN3_OFF]
0000041A: 0740  ;     ADD R7, R2, R0
0000041B:       ; 
0000041B:       ; TRAMPOLINE:
0000041B: D208  ;     LD R2, [R0, #JUMPTABLE]
0000041C: D240  ;     LD R2, [R2, #JUMP_NEAR_OFF]
0000041D: 0740  ;     ADD R7, R2, R0
0000041E:       ; 
0000041E:       ; 

Symbol Table: Labels
: MAIN_TABLE                        00000001  Local --
: COLOUR_TABLE_POINTER              00000001  Local --
: ADDRESS_TABLE_POINTER             00000002  Local --
: SOUND_TABLE_POINTER               00000003  Local --
: KEYPAD_TABLE_POINTER              00000004  Local --
: ASCII_TABLE_POINTER               00000005  Local --
: POSITION_TABLE_POINTER            00000006  Local --
: VARIABLES_TABLE_POINTER           00000007  Local --
: TABLE_POINTERS                    00000008  Local --
: BRANCHES_POINTER                  00000009  Local --
: MESSAGE_TABLE_POINTER             0000000A  Local --
: COLOURS                           00000001  Value
: ADDRESS                           00000002  Value
: SOUND                             00000003  Value
: KEYPAD                            00000004  Value
: ASCII                             00000005  Value
: POSITION                          00000006  Value
: VARIABLES                         00000007  Value
: JUMPTABLE                         00000008  Value
: BRANCH                            00000009  Value
: MESSAGE                           0000000A  Value
: COLOUR_TABLE                      0000000B  Local --
: WHITE_COLOR                       0000000B  Local --
: RED_COLOR                         0000000C  Local --
: BLACK_COLOR                       0000000D  Local --
: GREEN_COLOR                       0000000E  Local --
: WHITE_OFF                         00000000  Value
: RED_OFF                           00000001  Value
: BLACK_OFF                         00000002  Value
: GREEN_OFF                         00000003  Value
: ADDRESS_TABLE                     0000000F  Local --
: MATRIX_BASE_ADDR                  0000000F  Local --
: MATRIX_END_ADDR                   00000010  Local --
: LCD_START                         00000011  Local --
: SOUND_ADDR                        00000012  Local --
: KEYPAD_ADDR                       00000013  Local --
: FRC_ADDR                          00000014  Local --
: SW_SWITCH_ADDR                    00000015  Local --
: SW_LED_ADDR                       00000016  Local --
: MAT_BASE_OFF                      00000000  Value
: MAT_END_OFF                       00000001  Value
: LCD_START_OFF                     00000002  Value
: SOUND_ADDR_OFF                    00000003  Value
: KEY_ADDR_OFF                      00000004  Value
: FRC_ADDR_OFF                      00000005  Value
: SW_SWITCH_ADDR_OFF                00000006  Value
: SW_LED_ADDR_OFF                   00000007  Value
: SOUND_TABLE                       00000017  Local --
: G_NOTE                            00000017  Local --
: NOTE2                             00000018  Local --
: T_R1_SAVE                         00000019  Local --
: T_R2_SAVE                         0000001A  Local --
: MASK_6BITS                        0000001B  Local --
: value64                           0000001C  Local --
: LED_L_PAT                         0000001D  Local --
: G_NOTE_OFF                        00000000  Value
: NOTE2_OFF                         00000001  Value
: T_R1_SAVE_OFF                     00000002  Value
: T_R2_SAVE_OFF                     00000003  Value
: MASK_6BITS_OFF                    00000004  Value
: VALUE_64_OFFSET                   00000005  Value
: LED_L_PAT_OFF                     00000006  Value
: KEYPAD_TABLE                      0000001E  Local --
: KEYPAD_8                          0000001E  Local --
: KEYPAD_2                          0000001F  Local --
: KEYPAD_4                          00000020  Local --
: KEYPAD_6                          00000021  Local --
: KEYPAD_5                          00000022  Local --
: KEYPAD_FINISH                     00000023  Local --
: KEY_DOWN_OFF                      00000000  Value
: KEY_UP_OFF                        00000001  Value
: KEY_LEFT_OFF                      00000002  Value
: KEY_RIGHT_OFF                     00000003  Value
: KEY_SELECT_OFF                    00000004  Value
: KEY_PASS_OFF                      00000005  Value
: ASCII_TABLE                       00000024  Local --
: ASCII_P                           00000024  Local --
: ASCII_0                           00000025  Local --
: ASCII_P_OFF                       00000000  Value
: ASCII_0_OFF                       00000001  Value
: MSG_TABLE                         00000026  Local --
: MSG_START_PTR                     00000026  Local --
: MSG_END_PTR                       00000027  Local --
: MSG_SCROLL_PTR                    00000028  Local --
: MSG_LOOP_COUNT                    00000029  Local --
: MSG_ROWS                          0000002A  Local --
: MSG_COLS                          0000002B  Local --
: PIXEL_WORD_PTR                    0000002C  Local --
: PUZZLE_WORD_PTR                   0000002D  Local --
: PRESS_PTR                         0000002E  Local --
: PIXEL_MSG                         0000002F  Local --
: PIXEL_MSG_END                     0000004B  Local --
: WORD_PIXEL                        0000004B  Local --
: WORD_PUZZLE                       00000050  Local --
: PRESS_MSG                         00000056  Local --
: MSG_START_OFF                     00000000  Value
: MSG_END_OFF                       00000001  Value
: MSG_SCROLL_PTR_OFF                00000002  Value
: MSG_LOOP_COUNT_OFF                00000003  Value
: MSG_ROWS_OFF                      00000004  Value
: MSG_COLS_OFF                      00000005  Value
: PIXEL_WORD_PTR_OFF                00000006  Value
: PUZZLE_WORD_PTR_OFF               00000007  Value
: PRESS_PTR_OFF                     00000008  Value
: POSITION_TABLE                    0000006A  Local --
: CURRENT_POS                       0000006A  Local --
: BOUND1                            0000006B  Local --
: BOUND2                            0000006C  Local --
: BOUND3                            0000006D  Local --
: POINTER_POS1                      0000006E  Local --
: POINTER_POS2                      0000006F  Local --
: POINTER_POS3                      00000070  Local --
: POINTER_POS4                      00000071  Local --
: LOWER_BOUND1                      00000072  Local --
: LOWER_BOUND2                      00000073  Local --
: LOWER_BOUND3                      00000074  Local --
: LOWER_BOUND4                      00000075  Local --
: POINTER2_POS1                     00000076  Local --
: POINTER2_POS2                     00000077  Local --
: POINTER2_POS3                     00000078  Local --
: POINTER2_POS4                     00000079  Local --
: POS_CURRENT_OFF                   00000000  Value
: POS_BOUND1_OFF                    00000001  Value
: POS_BOUND2_OFF                    00000002  Value
: POS_BOUND3_OFF                    00000003  Value
: POS_PTR1_OFF                      00000004  Value
: POS_PTR2_OFF                      00000005  Value
: POS_PTR3_OFF                      00000006  Value
: POS_PTR4_OFF                      00000007  Value
: POS_LOWER1_OFF                    00000008  Value
: POS_LOWER2_OFF                    00000009  Value
: POS_LOWER3_OFF                    0000000A  Value
: POS_LOWER4_OFF                    0000000B  Value
: POS_PTR2_POS1_OFF                 0000000C  Value
: POS_PTR2_POS2_OFF                 0000000D  Value
: POS_PTR2_POS3_OFF                 0000000E  Value
: POS_PTR2_POS4_OFF                 0000000F  Value
: SEL_POS_TABLE                     00000004  Value
: LEV_POS_TABLE                     0000000C  Value
: REET                              0000007A  Local --
: VARIABLES_TABLE                   0000007B  Local --
: OUTER_COUNT                       0000007B  Local --
: INNER_COUNT                       0000007C  Local --
: LOWER_BOUND                       0000007D  Local --
: UPPER_BOUND                       0000007E  Local --
: POINTER_POS                       0000007F  Local --
: ONE                               00000080  Local --
: ZERO                              00000081  Local --
: UPBRANCH1                         00000082  Local --
: UPBRANCH2                         00000083  Local --
: LEFTBRANCH1                       00000084  Local --
: LEFTBRANCH2                       00000085  Local --
: RIGHTBRANCH1                      00000086  Local --
: RIGHTBRANCH2                      00000087  Local --
: DOWNBRANCH1                       00000088  Local --
: DOWNBRANCH2                       00000089  Local --
: LEVEL_COUNTER                     0000008A  Local --
: VAR_OUTER_OFF                     00000000  Value
: VAR_INNER_OFF                     00000001  Value
: VAR_LOWER_OFF                     00000002  Value
: VAR_UPPER_OFF                     00000003  Value
: VAR_PTR_OFF                       00000004  Value
: VAR_ONE_OFF                       00000005  Value
: VAR_ZERO_OFF                      00000006  Value
: VAR_UP1_OFF                       00000007  Value
: VAR_UP2_OFF                       00000008  Value
: VAR_LEFT1_OFF                     00000009  Value
: VAR_LEFT2_OFF                     0000000A  Value
: VAR_RIGHT1_OFF                    0000000B  Value
: VAR_RIGHT2_OFF                    0000000C  Value
: VAR_DOWN1_OFF                     0000000D  Value
: VAR_DOWN2_OFF                     0000000E  Value
: VAR_LEVEL_CNT_OFF                 0000000F  Value
: JUMP_TABLE                        0000008B  Local --
: NEAR_JUMP                         0000008B  Local --
: RESET1                            0000008C  Local --
: LEVEL1_J                          0000008D  Local --
: JUMP_NEAR_OFF                     00000000  Value
: JUMP_RST_OFF                      00000001  Value
: JUMP_LVL1_OFF                     00000002  Value
: SELECTED_POSITIONS_TABLE          0000008E  Local --
: POS_0                             0000008E  Local --
: POS_1                             0000008F  Local --
: POS_2                             00000090  Local --
: POS_3                             00000091  Local --
: POS_4                             00000092  Local --
: POS_5                             00000093  Local --
: POS_6                             00000094  Local --
: POS_7                             00000095  Local --
: POS_8                             00000096  Local --
: POS_9                             00000097  Local --
: POS_10                            00000098  Local --
: POS_11                            00000099  Local --
: POS_12                            0000009A  Local --
: POS_13                            0000009B  Local --
: POS_14                            0000009C  Local --
: POS_15                            0000009D  Local --
: SELECTED_POSITIONS_TABLE2         0000009E  Local --
: POS_16                            0000009E  Local --
: POS_17                            0000009F  Local --
: POS_18                            000000A0  Local --
: POS_19                            000000A1  Local --
: POS_20                            000000A2  Local --
: POS_21                            000000A3  Local --
: POS_22                            000000A4  Local --
: POS_23                            000000A5  Local --
: POS_24                            000000A6  Local --
: POS_25                            000000A7  Local --
: POS_26                            000000A8  Local --
: POS_27                            000000A9  Local --
: POS_28                            000000AA  Local --
: POS_29                            000000AB  Local --
: POS_30                            000000AC  Local --
: POS_31                            000000AD  Local --
: SELECTED_POSITIONS_TABLE3         000000AE  Local --
: POS_32                            000000AE  Local --
: POS_33                            000000AF  Local --
: POS_34                            000000B0  Local --
: POS_35                            000000B1  Local --
: POS_36                            000000B2  Local --
: POS_37                            000000B3  Local --
: POS_38                            000000B4  Local --
: POS_39                            000000B5  Local --
: POS_40                            000000B6  Local --
: POS_41                            000000B7  Local --
: POS_42                            000000B8  Local --
: POS_43                            000000B9  Local --
: POS_44                            000000BA  Local --
: POS_45                            000000BB  Local --
: POS_46                            000000BC  Local --
: POS_47                            000000BD  Local --
: SELECTED_POSITIONS_TABLE4         000000BE  Local --
: POS_48                            000000BE  Local --
: POS_49                            000000BF  Local --
: POS_50                            000000C0  Local --
: POS_51                            000000C1  Local --
: POS_52                            000000C2  Local --
: POS_53                            000000C3  Local --
: POS_54                            000000C4  Local --
: POS_55                            000000C5  Local --
: POS_56                            000000C6  Local --
: POS_57                            000000C7  Local --
: POS_58                            000000C8  Local --
: POS_59                            000000C9  Local --
: POS_60                            000000CA  Local --
: POS_61                            000000CB  Local --
: POS_62                            000000CC  Local --
: POS_63                            000000CD  Local --
: BRANCHES_TABLE                    000000CE  Local --
: WAIT1                             000000CE  Local --
: CHECK1                            000000CF  Local --
: UPBRANCH11                        000000D0  Local --
: UPBRANCH21                        000000D1  Local --
: UPBRANCH31                        000000D2  Local --
: LEFTBRANCH11                      000000D3  Local --
: LEFTBRANCH21                      000000D4  Local --
: LEFTBRANCH31                      000000D5  Local --
: RIGHTBRANCH11                     000000D6  Local --
: RIGHTBRANCH21                     000000D7  Local --
: RIGHTBRANCH31                     000000D8  Local --
: DOWNBRANCH11                      000000D9  Local --
: DOWNBRANCH21                      000000DA  Local --
: DOWNBRANCH31                      000000DB  Local --
: BR_WAIT_OFF                       00000000  Value
: BR_CHECK_OFF                      00000001  Value
: BR_UP1_OFF                        00000002  Value
: BR_UP2_OFF                        00000003  Value
: BR_UP3_OFF                        00000004  Value
: BR_LEFT1_OFF                      00000005  Value
: BR_LEFT2_OFF                      00000006  Value
: BR_LEFT3_OFF                      00000007  Value
: BR_RIGHT1_OFF                     00000008  Value
: BR_RIGHT2_OFF                     00000009  Value
: BR_RIGHT3_OFF                     0000000A  Value
: BR_DOWN1_OFF                      0000000B  Value
: BR_DOWN2_OFF                      0000000C  Value
: BR_DOWN3_OFF                      0000000D  Value
: REST                              000000DC  Local --
: LEVEL_POSITIONS_TABLE             000000DD  Local --
: POS2_0                            000000DD  Local --
: POS2_1                            000000DE  Local --
: POS2_2                            000000DF  Local --
: POS2_3                            000000E0  Local --
: POS2_4                            000000E1  Local --
: POS2_5                            000000E2  Local --
: POS2_6                            000000E3  Local --
: POS2_7                            000000E4  Local --
: POS2_8                            000000E5  Local --
: POS2_9                            000000E6  Local --
: POS2_10                           000000E7  Local --
: POS2_11                           000000E8  Local --
: POS2_12                           000000E9  Local --
: POS2_13                           000000EA  Local --
: POS2_14                           000000EB  Local --
: POS2_15                           000000EC  Local --
: LEVEL_POSITIONS_TABLE2            000000ED  Local --
: POS2_16                           000000ED  Local --
: POS2_17                           000000EE  Local --
: POS2_18                           000000EF  Local --
: POS2_19                           000000F0  Local --
: POS2_20                           000000F1  Local --
: POS2_21                           000000F2  Local --
: POS2_22                           000000F3  Local --
: POS2_23                           000000F4  Local --
: POS2_24                           000000F5  Local --
: POS2_25                           000000F6  Local --
: POS2_26                           000000F7  Local --
: POS2_27                           000000F8  Local --
: POS2_28                           000000F9  Local --
: POS2_29                           000000FA  Local --
: POS2_30                           000000FB  Local --
: POS2_31                           000000FC  Local --
: LEVEL_POSITIONS_TABLE3            000000FD  Local --
: POS2_32                           000000FD  Local --
: POS2_33                           000000FE  Local --
: POS2_34                           000000FF  Local --
: POS2_35                           00000100  Local --
: POS2_36                           00000101  Local --
: POS2_37                           00000102  Local --
: POS2_38                           00000103  Local --
: POS2_39                           00000104  Local --
: POS2_40                           00000105  Local --
: POS2_41                           00000106  Local --
: POS2_42                           00000107  Local --
: POS2_43                           00000108  Local --
: POS2_44                           00000109  Local --
: POS2_45                           0000010A  Local --
: POS2_46                           0000010B  Local --
: POS2_47                           0000010C  Local --
: LEVEL_POSITIONS_TABLE4            0000010D  Local --
: POS2_48                           0000010D  Local --
: POS2_49                           0000010E  Local --
: POS2_50                           0000010F  Local --
: POS2_51                           00000110  Local --
: POS2_52                           00000111  Local --
: POS2_53                           00000112  Local --
: POS2_54                           00000113  Local --
: POS2_55                           00000114  Local --
: POS2_56                           00000115  Local --
: POS2_57                           00000116  Local --
: POS2_58                           00000117  Local --
: POS2_59                           00000118  Local --
: POS2_60                           00000119  Local --
: POS2_61                           0000011A  Local --
: POS2_62                           0000011B  Local --
: POS2_63                           0000011C  Local --
: RESET                             0000011D  Local --
: LOOP                              00000123  Local --
: ZERO_LOOP                         00000133  Local --
: INIT_DISPLAY2                     0000013A  Local --
: INIT2_CLR_ROWS                    00000141  Local --
: INIT2_CLR_COLS                    00000143  Local --
: INIT_DISPLAY                      00000154  Local --
: INIT_CLR_ROWS                     0000015B  Local --
: INIT_CLR_COLS                     0000015D  Local --
: PIXEL_SWEEP_LOOP                  00000164  Local --
: PIXEL_CLR_ROW0                    00000169  Local --
: PIXEL_COPY_LOOP                   00000171  Local --
: PIXEL_DELAY_OUTER                 00000179  Local --
: PIXEL_DELAY_INNER                 0000017B  Local --
: PIXEL_SWEEP_DONE                  00000186  Local --
: PUZZLE_SWEEP_LOOP                 00000189  Local --
: PUZZLE_CLR_ROW1                   00000191  Local --
: PUZZLE_COPY_LOOP                  00000199  Local --
: PUZZLE_DELAY_OUTER                000001A1  Local --
: PUZZLE_DELAY_INNER                000001A3  Local --
: PUZZLE_SWEEP_DONE                 000001AB  Local --
: CLEAR_TOP_ROWS                    000001B0  Local --
: CLEAR_TOP_COLS                    000001B1  Local --
: PRESS_COPY_LOOP                   000001C2  Local --
: WAIT_KEY_PRESS                    000001C8  Local --
: WAIT_KEY_RELEASE                  000001CD  Local --
: LEVEL1                            000001D3  Local --
: DISPLAY_LEVEL_PATTERN             000001D6  Local --
: CHOOSE_RANDOM_PIXEL_FOR_LEVEL     000001D8  Local --
: LOAD_FIRST_POS_FOR_LEVEL          000001EF  Local --
: LOAD_SECOND_POS_FOR_LEVEL         000001F4  Local --
: LOAD_THIRD_POS_FOR_LEVEL          000001F9  Local --
: LOAD_FOURTH_POS_FOR_LEVEL         000001FE  Local --
: AFTER_LOADING_POS_FOR_LEVEL       00000203  Local --
: DELAY_LEVEL_DISPLAY               00000215  Local --
: LVL_DELAY_K_LOOP                  00000219  Local --
: LVL_OUTER_L_LOOP                  0000021B  Local --
: LVL_INNER_L_LOOP                  0000021D  Local --
: FINISH_LEVEL_PATTERN              00000226  Local --
: LOOP_CLEAR                        0000022F  Local --
: LOAD                              00000234  Local --
: WAIT_FOR_KEYPAD_ZERO              0000023D  Local --
: NEAR_UPDATE_CURRENT               00000243  Local --
: DELAY3                            00000246  Local --
: OUTER_LOOP3                       00000248  Local --
: INNER_LOOP3                       0000024A  Local --
: START_GAME                        00000251  Local --
: WAIT                              00000253  Local --
: KEY_PAD_NOW_ZERO                  00000259  Local --
: UP                                00000272  Local --
: UPBRANC1                          00000277  Local --
: UPBRANC2                          00000278  Local --
: UP_BACK                           0000027D  Local --
: UPBRANC3                          00000282  Local --
: LEFT                              00000284  Local --
: LEFTBRANC1                        00000289  Local --
: LEFTBRANC2                        0000028A  Local --
: LEFT_BACK                         0000028F  Local --
: LEFTBRANC3                        00000294  Local --
: DOWN                              00000296  Local --
: DOWNBRANC1                        0000029B  Local --
: DOWNBRANC2                        0000029C  Local --
: DOWN_BACK                         000002A1  Local --
: DOWNBRANC3                        000002A6  Local --
: RIGHT                             000002A8  Local --
: RIGHTBRANC1                       000002AD  Local --
: RIGHTBRANC2                       000002AE  Local --
: RIGHT_BACK                        000002B3  Local --
: RIGHTBRANC3                       000002B8  Local --
: UP_CHECK                          000002BA  Local --
: DOWN_CHECK                        000002BC  Local --
: LEFT_CHECK                        000002BE  Local --
: RIGHT_CHECK                       000002C0  Local --
: STORE                             000002C2  Local --
: AFTER_LOADING_POS_TABLE2          000002CF  Local --
: PASS                              000002D5  Local --
: PASSED                            000002DD  Local --
: CHECK_LOOP                        000002E2  Local --
: LOAD_FIRST_POS_TABLE2             000002EB  Local --
: LOAD_SECOND_POS_TABLE2            000002F0  Local --
: LOAD_THIRD_POS_TABLE2             000002F5  Local --
: LOAD_FOURTH_POS_TABLE2            000002FA  Local --
: ADD_DATA_IN                       000002FF  Local --
: DELETE_DATA                       0000030A  Local --
: FAIL                              00000311  Local --
: FAIL_INIT_LOOP                    00000318  Local --
: FAIL_INIT_MISSED                  00000322  Local --
: FAIL_INIT_NEXT                    00000325  Local --
: FAIL_LOOP                         0000032F  Local --
: FAIL_RED_LOOP                     00000336  Local --
: FAIL_RED_MISSED                   00000340  Local --
: FAIL_RED_NEXT                     00000343  Local --
: FAIL_RED_DELAY_OUTER              00000348  Local --
: FAIL_RED_DELAY_O                  0000034A  Local --
: FAIL_RED_DELAY_I                  0000034C  Local --
: FAIL_BLK_LOOP                     00000357  Local --
: FAIL_BLK_MISSED                   00000361  Local --
: FAIL_BLK_NEXT                     00000364  Local --
: FAIL_BLK_DELAY_OUTER              00000369  Local --
: FAIL_BLK_DELAY_O                  0000036B  Local --
: FAIL_BLK_DELAY_I                  0000036D  Local --
: FAIL_HARD_RESET                   00000378  Local --
: FAIL_ZERO_LOOP                    00000380  Local --
: CHECK                             0000038C  Local --
: AFTER_LOADING_POS_TABLE           00000399  Local --
: SET_REGISTER_0                    000003A3  Local --
: SET_REGISTER_1                    000003C3  Local --
: LOAD_FIRST_POS_TABLE              000003E3  Local --
: LOAD_SECOND_POS_TABLE             000003E8  Local --
: LOAD_THIRD_POS_TABLE              000003ED  Local --
: LOAD_FOURTH_POS_TABLE             000003F2  Local --
: UPBRANC1TRAMPOLINE                000003F7  Local --
: UPBRANC2TRAMPOLINE                000003FA  Local --
: UPBRANC3TRAMPOLINE                000003FD  Local --
: LEFTBRANC1TRAMPOLINE              00000400  Local --
: LEFTBRANC2TRAMPOLINE              00000403  Local --
: LEFTBRANC3TRAMPOLINE              00000406  Local --
: RIGHTBRANC1TRAMPOLINE             00000409  Local --
: RIGHTBRANC2TRAMPOLINE             0000040C  Local --
: RIGHTBRANC3TRAMPOLINE             0000040F  Local --
: DOWNBRANC1TRAMPOLINE              00000412  Local --
: DOWNBRANC2TRAMPOLINE              00000415  Local --
: DOWNBRANC3TRAMPOLINE              00000418  Local --
: TRAMPOLINE                        0000041B  Local --
